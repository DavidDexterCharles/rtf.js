{"version":3,"sources":["webpack://[name]/webpack/universalModuleDefinition","webpack://[name]/webpack/bootstrap","webpack://[name]/./src/util/index.ts","webpack://[name]/./src/util/SVG.ts","webpack://[name]/./src/wmfjs/index.ts","webpack://[name]/./src/wmfjs/Renderer.ts","webpack://[name]/./src/wmfjs/Blob.ts","webpack://[name]/./src/wmfjs/Helper.ts","webpack://[name]/./src/wmfjs/GDIContext.ts","webpack://[name]/./src/wmfjs/Primitives.ts","webpack://[name]/./src/wmfjs/Region.ts","webpack://[name]/./src/wmfjs/Style.ts","webpack://[name]/./src/wmfjs/Bitmap.ts","webpack://[name]/./src/wmfjs/WMFRecords.ts"],"names":["root","factory","exports","module","define","amd","this","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","flood","filter","resultId","color","opacity","_settings","floodElement","document","createElementNS","setAttribute","toString","appendChild","composite","in1","in2","k1","k2","k3","k4","compositeElement","svg","filters","SVGFilters","_defs","undefined","_svg","parent","x","y","width","height","settings","svgElement","_appendSettings","image","url","imageElement","setAttributeNS","rect","rx","ry","rectElement","Number","line","x1","y1","x2","y2","lineElement","polygon","points","polygonElement","join","polyline","polylineElement","ellipse","cx","cy","ellipseElement","text","textElement","textNode","createTextNode","id","filterElement","pattern","patternElement","defs","defsElement","clipPath","units","clipElement","element","keys","forEach","blob","parse","log","render","info","_render","mapMode","xExt","yExt","_img","type","size","placable","headerstart","reader","readUint32","WMFPlacable","pos","readUint16","GDI","MetafileType","MEMORYMETAFILE","DISKMETAFILE","METAHEADER_SIZE","version","MetafileVersion","METAVERSION100","METAVERSION300","WMF","gdi","setViewportExt","setMapMode","left","readInt16","top","right","bottom","skip","boundingBox","WMFRect16","unitsPerInch","hdrsize","_version","_hdrsize","_placable","_records","play","offset","Blob","data","Uint8Array","eof","length","seek","newpos","cnt","newPos","readBinary","ret","String","fromCharCode","readInt8","readUint8","readInt32","val","readString","readNullTermString","maxSize","byte","WMFJSError","message","stack","Error","isLoggingEnabled","loggingEnabled","enabled","console","_makeUniqueId","prefix","_uniqueId","_writeUint32Val","uint8arr","_blobToBinary","len","BITMAPINFOHEADER_SIZE","BITMAPCOREHEADER_SIZE","RecordType","META_EOF","META_REALIZEPALETTE","META_SETPALENTRIES","META_SETBKMODE","META_SETMAPMODE","META_SETROP2","META_SETRELABS","META_SETPOLYFILLMODE","META_SETSTRETCHBLTMODE","META_SETTEXTCHAREXTRA","META_RESTOREDC","META_RESIZEPALETTE","META_DIBCREATEPATTERNBRUSH","META_SETLAYOUT","META_SETBKCOLOR","META_SETTEXTCOLOR","META_OFFSETVIEWPORTORG","META_LINETO","META_MOVETO","META_OFFSETCLIPRGN","META_FILLREGION","META_SETMAPPERFLAGS","META_SELECTPALETTE","META_POLYGON","META_POLYLINE","META_SETTEXTJUSTIFICATION","META_SETWINDOWORG","META_SETWINDOWEXT","META_SETVIEWPORTORG","META_SETVIEWPORTEXT","META_OFFSETWINDOWORG","META_SCALEWINDOWEXT","META_SCALEVIEWPORTEXT","META_EXCLUDECLIPRECT","META_INTERSECTCLIPRECT","META_ELLIPSE","META_FLOODFILL","META_FRAMEREGION","META_ANIMATEPALETTE","META_TEXTOUT","META_POLYPOLYGON","META_EXTFLOODFILL","META_RECTANGLE","META_SETPIXEL","META_ROUNDRECT","META_PATBLT","META_SAVEDC","META_PIE","META_STRETCHBLT","META_ESCAPE","META_INVERTREGION","META_PAINTREGION","META_SELECTCLIPREGION","META_SELECTOBJECT","META_SETTEXTALIGN","META_ARC","META_CHORD","META_BITBLT","META_EXTTEXTOUT","META_SETDIBTODEV","META_DIBBITBLT","META_DIBSTRETCHBLT","META_STRETCHDIB","META_DELETEOBJECT","META_CREATEPALETTE","META_CREATEPATTERNBRUSH","META_CREATEPENINDIRECT","META_CREATEFONTINDIRECT","META_CREATEBRUSHINDIRECT","META_CREATEREGION","MetafileEscapes","NEWFRAME","ABORTDOC","NEXTBAND","SETCOLORTABLE","GETCOLORTABLE","FLUSHOUT","DRAFTMODE","QUERYESCSUPPORT","SETABORTPROC","STARTDOC","ENDDOC","GETPHYSPAGESIZE","GETPRINTINGOFFSET","GETSCALINGFACTOR","META_ESCAPE_ENHANCED_METAFILE","SETPENWIDTH","SETCOPYCOUNT","SETPAPERSOURCE","PASSTHROUGH","GETTECHNOLOGY","SETLINECAP","SETLINEJOIN","SETMITERLIMIT","BANDINFO","DRAWPATTERNRECT","GETVECTORPENSIZE","GETVECTORBRUSHSIZE","ENABLEDUPLEX","GETSETPAPERBINS","GETSETPRINTORIENT","ENUMPAPERBINS","SETDIBSCALING","EPSPRINTING","ENUMPAPERMETRICS","GETSETPAPERMETRICS","POSTSCRIPT_DATA","POSTSCRIPT_IGNORE","GETDEVICEUNITS","GETEXTENDEDTEXTMETRICS","GETPAIRKERNTABLE","EXTTEXTOUT","GETFACENAME","DOWNLOADFACE","METAFILE_DRIVER","QUERYDIBSUPPORT","BEGIN_PATH","CLIP_TO_PATH","END_PATH","OPEN_CHANNEL","DOWNLOADHEADER","CLOSE_CHANNEL","POSTSCRIPT_PASSTHROUGH","ENCAPSULATED_POSTSCRIPT","POSTSCRIPT_IDENTIFY","POSTSCRIPT_INJECTION","CHECKJPEGFORMAT","CHECKPNGFORMAT","GET_PS_FEATURESETTING","MXDC_ESCAPE","SPCLPASSTHROUGH2","MapMode","MM_TEXT","MM_LOMETRIC","MM_HIMETRIC","MM_LOENGLISH","MM_HIENGLISH","MM_TWIPS","MM_ISOTROPIC","MM_ANISOTROPIC","StretchMode","BLACKONWHITE","WHITEONBLACK","COLORONCOLOR","HALFTONE","TextAlignmentMode","TA_UPDATECP","TA_RIGHT","TA_CENTER","TA_BOTTOM","TA_BASELINE","TA_RTLREADING","MixMode","TRANSPARENT","OPAQUE","VerticalTextAlignmentMode","VTA_BOTTOM","VTA_CENTER","VTA_LEFT","VTA_BASELINE","BrushStyle","BS_SOLID","BS_NULL","BS_HATCHED","BS_PATTERN","BS_INDEXED","BS_DIBPATTERN","BS_DIBPATTERNPT","BS_PATTERN8X8","BS_DIBPATTERN8X8","BS_MONOPATTERN","PenStyle","PS_SOLID","PS_DASH","PS_DOT","PS_DASHDOT","PS_DASHDOTDOT","PS_NULL","PS_INSIDEFRAME","PS_USERSTYLE","PS_ALTERNATE","PS_ENDCAP_SQUARE","PS_ENDCAP_FLAT","PS_JOIN_BEVEL","PS_JOIN_MITER","PolyFillMode","ALTERNATE","WINDING","ColorUsage","DIB_RGB_COLORS","DIB_PAL_COLORS","DIB_PAL_INDICES","PaletteEntryFlag","PC_RESERVED","PC_EXPLICIT","PC_NOCOLLAPSE","BitmapCompression","BI_RGB","BI_RLE8","BI_RLE4","BI_BITFIELDS","BI_JPEG","BI_PNG","copy","defObjects","_svggroup","_svgclipChanged","_svgtextbkfilter","mapmode","stretchmode","textalign","bkmode","textcolor","clone","bkcolor","polyfillmode","wx","wy","ww","wh","vx","vy","vw","vh","clip","ownclip","selected","defObj","_svgdefs","_svgPatterns","_svgClipPaths","brush","pen","font","palette","region","state","GDIContextState","statestack","objects","setWindowOrg","setWindowExt","offsetWindowOrg","offX","offY","setViewportOrg","offsetViewportOrg","saveDC","prevstate","push","restoreDC","saved","pop","escape","func","count","setStretchBltMode","stretchMode","stretchDib","srcX","srcY","srcW","srcH","dstX","dstY","dstW","dstH","rasterOp","colorUsage","dib","_todevX","_todevY","_todevW","_todevH","_pushGroup","base64ref","stretchDibBits","rectangle","rw","rh","opts","_applyOpts","textOut","escapement","transform","style","filterId","_getSvgDef","toHex","extTextOut","fwOpts","dx","lineTo","toX","toY","fromX","fromY","moveTo","first","pts","point","polyPolygon","polygons","fill","width2","height2","excludeClipRect","_getClipRgn","subtract","intersectClipRect","intersect","offsetClipRgn","setTextAlign","textAlignmentMode","setBkMode","bkMode","setTextColor","textColor","setBkColor","bkColor","setPolyFillMode","polyFillMode","createBrush","idx","_storeObject","createFont","createPen","createPalette","createRegion","createPatternBrush","patternBrush","selectObject","objIdx","checkType","obj","_getObject","_selectObject","deleteObject","_deleteObject","viewBox","preserveAspectRatio","_getSvgClipPathForRegion","existingId","sclip","complexity","bounds","strokeWidth","scans","scan","j","scanlines","scanline","_getSvgPatternForBrush","img","getWidth","getHeight","dibpatternpt","spat","patternUnits","Math","floor","_tologicalX","_tologicalY","_tologicalW","_tologicalH","usePen","useBrush","useFont","stroke","dotWidth","linecap","dashWidth","dotSpacing","facename","abs","PointS","Rect","empty","max","min","scanCnt","Scan","_updateComplexity","Region","si","cloned","splice","last","slen","CreateSimpleRegion","rgn","g","b","ColorRef","slice","orientation","weight","italic","underline","strikeout","charset","outprecision","clipprecision","quality","pitchAndFamily","pitch","family","dataLength","start","Font","JSON","stringify","forceDibPattern","colorusage","hatchstyle","Brush","Pen","flag","PaletteEntry","entries","Palette","skipsize","planes","bitcount","colors","compression","sizeimage","xpelspermeter","ypelspermeter","clrused","clrimportant","usergb","_reader","_offset","_usergb","_infosize","_header","BitmapCoreHeader","BitmapInfoHeader","masks","infosize","header","BitmapBase","_size","_info","BitmapInfo","prevpos","mime","makeBitmapFileHeader","ref","btoa","buf","ArrayBuffer","view","widthBytes","bitsPixel","bitsOffset","bitsSize","Bitmap16","PatternBitmap16","all","curpos","datalength","hasRect","hasDx","polygonsPtCnts","ptCnt","ip","patternBitmap","recordName","main_loop"],"mappings":"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","file":"WMFJS.bundle.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"WMFJS\"] = factory();\n\telse\n\t\troot[\"WMFJS\"] = factory();\n})(this, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 34);\n","/*\n\nThe MIT License (MIT)\n\nCopyright (c) 2020 Tom Zoehner\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n\n*/\n\nexport { SVG } from \"./SVG\";\n","class SVGFilters {\n\n    public flood(filter: SVGFilterElement, resultId: string, color: string, opacity: number, _settings?: any): void {\n        const floodElement = document.createElementNS(\"http://www.w3.org/2000/svg\", \"feFlood\");\n        if (resultId) {\n            floodElement.setAttribute(\"id\", resultId);\n        }\n        floodElement.setAttribute(\"flood-color\", color);\n        floodElement.setAttribute(\"flood-opacity\", opacity.toString());\n        filter.appendChild(floodElement);\n    }\n\n    public composite(filter: SVGFilterElement,\n                     resultId: string,\n                     in1: string,\n                     in2: string,\n                     k1?: number,\n                     k2?: number,\n                     k3?: number,\n                     k4?: number,\n                     _settings?: any): void {\n        const compositeElement = document.createElementNS(\"http://www.w3.org/2000/svg\", \"feComposite\");\n        if (resultId) {\n            compositeElement.setAttribute(\"id\", resultId);\n        }\n        compositeElement.setAttribute(\"in\", in1);\n        compositeElement.setAttribute(\"in2\", in2);\n        filter.appendChild(compositeElement);\n    }\n}\n\nexport class SVG {\n    public filters = new SVGFilters();\n    private _svg: SVGElement;\n    private _defs: SVGDefsElement | undefined = undefined;\n\n    constructor(svg: SVGElement) {\n        this._svg = svg;\n    }\n\n    public svg(parent: Element,\n               x: number,\n               y: number,\n               width: number,\n               height: number,\n               settings?: any): SVGElement {\n        const svgElement = document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\");\n        svgElement.setAttribute(\"x\", x.toString());\n        svgElement.setAttribute(\"y\", y.toString());\n        svgElement.setAttribute(\"width\", `${width}px`);\n        svgElement.setAttribute(\"height\", `${height}px`);\n        this._appendSettings(settings, svgElement);\n\n        if (parent != null) {\n            parent.appendChild(svgElement);\n        } else {\n            this._svg.appendChild(svgElement);\n        }\n\n        return svgElement;\n    }\n\n    public image(parent: Element,\n                 x: number,\n                 y: number,\n                 width: number,\n                 height: number,\n                 url: string,\n                 settings?: any): SVGImageElement {\n        const imageElement = document.createElementNS(\"http://www.w3.org/2000/svg\", \"image\");\n        imageElement.setAttribute(\"x\", x.toString());\n        imageElement.setAttribute(\"y\", y.toString());\n        imageElement.setAttribute(\"width\", `${width}px`);\n        imageElement.setAttribute(\"height\", `${height}px`);\n        imageElement.setAttributeNS(\"http://www.w3.org/1999/xlink\", \"href\", url);\n        this._appendSettings(settings, imageElement);\n        parent.appendChild(imageElement);\n        return imageElement;\n    }\n\n    public rect(parent: Element,\n                x: number,\n                y: number,\n                width: number,\n                height: number,\n                rx?: number,\n                ry?: number,\n                settings?: any): SVGRectElement;\n    public rect(parent: Element, x: number, y: number, width: number, height: number, settings?: any): SVGRectElement;\n    public rect(parent: Element,\n                x: number,\n                y: number,\n                width: number,\n                height: number,\n                rx?: number | any,\n                ry?: number,\n                settings?: any): SVGRectElement {\n        const rectElement = document.createElementNS(\"http://www.w3.org/2000/svg\", \"rect\");\n        rectElement.setAttribute(\"x\", x.toString());\n        rectElement.setAttribute(\"y\", y.toString());\n        rectElement.setAttribute(\"width\", `${width}px`);\n        rectElement.setAttribute(\"height\", `${height}px`);\n        if (rx !== undefined) {\n            if (rx instanceof Number) {\n                rectElement.setAttribute(\"rx\", rx.toString());\n            } else if (rx instanceof Object) {\n                this._appendSettings(rx, rectElement);\n            }\n        }\n        if (ry !== undefined) {\n            rectElement.setAttribute(\"ry\", ry.toString());\n        }\n        this._appendSettings(settings, rectElement);\n        parent.appendChild(rectElement);\n        return rectElement;\n    }\n\n    public line(parent: Element, x1: number, y1: number, x2: number, y2: number, settings?: any): SVGLineElement {\n        const lineElement = document.createElementNS(\"http://www.w3.org/2000/svg\", \"line\");\n        lineElement.setAttribute(\"x1\", x1.toString());\n        lineElement.setAttribute(\"y1\", y1.toString());\n        lineElement.setAttribute(\"x2\", x2.toString());\n        lineElement.setAttribute(\"y2\", y2.toString());\n        this._appendSettings(settings, lineElement);\n        parent.appendChild(lineElement);\n        return lineElement;\n    }\n\n    public polygon(parent: Element, points: number[][], settings?: any): SVGPolygonElement {\n        const polygonElement = document.createElementNS(\"http://www.w3.org/2000/svg\", \"polygon\");\n        polygonElement.setAttribute(\"points\", points.join(\",\"));\n        this._appendSettings(settings, polygonElement);\n        parent.appendChild(polygonElement);\n        return polygonElement;\n    }\n\n    public polyline(parent: Element, points: number[][], settings?: any): SVGPolylineElement {\n        const polylineElement = document.createElementNS(\"http://www.w3.org/2000/svg\", \"polyline\");\n        polylineElement.setAttribute(\"points\", points.join(\",\"));\n        this._appendSettings(settings, polylineElement);\n        parent.appendChild(polylineElement);\n        return polylineElement;\n    }\n\n    public ellipse(parent: Element, cx: number, cy: number, rx: number, ry: number, settings?: any): SVGEllipseElement {\n        const ellipseElement = document.createElementNS(\"http://www.w3.org/2000/svg\", \"ellipse\");\n        ellipseElement.setAttribute(\"cx\", cx.toString());\n        ellipseElement.setAttribute(\"cy\", cy.toString());\n        ellipseElement.setAttribute(\"rx\", rx.toString());\n        ellipseElement.setAttribute(\"ry\", ry.toString());\n        this._appendSettings(settings, ellipseElement);\n        parent.appendChild(ellipseElement);\n        return ellipseElement;\n    }\n\n    public text(parent: Element, x: number, y: number, value: string, settings?: any): SVGTextElement {\n        const textElement = document.createElementNS(\"http://www.w3.org/2000/svg\", \"text\");\n        textElement.setAttribute(\"x\", x.toString());\n        textElement.setAttribute(\"y\", y.toString());\n        this._appendSettings(settings, textElement);\n        const textNode = document.createTextNode(value);\n        textElement.appendChild(textNode);\n        parent.appendChild(textElement);\n        return textElement;\n    }\n\n    public filter(parent: Element,\n                  id: string,\n                  x: number,\n                  y: number,\n                  width: number,\n                  height: number,\n                  settings?: any): SVGFilterElement {\n        const filterElement = document.createElementNS(\"http://www.w3.org/2000/svg\", \"filter\");\n        filterElement.setAttribute(\"x\", x.toString());\n        filterElement.setAttribute(\"y\", y.toString());\n        filterElement.setAttribute(\"width\", `${width}px`);\n        filterElement.setAttribute(\"height\", `${height}px`);\n        this._appendSettings(settings, filterElement);\n        parent.appendChild(filterElement);\n        return filterElement;\n    }\n\n    public pattern(parent: Element,\n                   resultId: string,\n                   x: number,\n                   y: number,\n                   width: number,\n                   height: number,\n                   settings?: any): SVGPatternElement {\n        const patternElement = document.createElementNS(\"http://www.w3.org/2000/svg\", \"pattern\");\n        if (resultId) {\n            patternElement.setAttribute(\"id\", resultId);\n        }\n        patternElement.setAttribute(\"x\", x.toString());\n        patternElement.setAttribute(\"y\", y.toString());\n        patternElement.setAttribute(\"width\", `${width}px`);\n        patternElement.setAttribute(\"height\", `${height}px`);\n        this._appendSettings(settings, patternElement);\n        parent.appendChild(patternElement);\n        return patternElement;\n    }\n\n    public defs(): SVGDefsElement {\n        if (this._defs === undefined) {\n            const defsElement = document.createElementNS(\"http://www.w3.org/2000/svg\", \"defs\");\n            this._svg.appendChild(defsElement);\n            this._defs = defsElement;\n        }\n        return this._defs;\n    }\n\n    public clipPath(parent: Element, resultId: string, units?: string, settings?: any): SVGClipPathElement {\n        const clipElement = document.createElementNS(\"http://www.w3.org/2000/svg\", \"clipPath\");\n        if (resultId) {\n            clipElement.setAttribute(\"id\", resultId);\n        }\n        if (units === undefined) {\n            units = \"userSpaceOnUse\";\n        }\n        clipElement.setAttribute(\"clipPathUnits\", units);\n        this._appendSettings(settings, clipElement);\n        parent.appendChild(clipElement);\n        return clipElement;\n    }\n\n    private _appendSettings(settings: any | undefined, element: Element): void {\n        if (settings !== undefined) {\n            Object.keys(settings).forEach((key) => {\n                element.setAttribute(key, settings[key]);\n            });\n        }\n    }\n\n}\n","/*\n\nThe MIT License (MIT)\n\nCopyright (c) 2015 Thomas Bluemel\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n\n*/\n\nexport { Renderer, IRendererSettings } from \"./Renderer\";\nexport { WMFJSError as Error, loggingEnabled } from \"./Helper\";\n","/*\n\nThe MIT License (MIT)\n\nCopyright (c) 2015 Thomas Bluemel\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n\n*/\n\nimport { SVG } from \"../util\";\nimport { Blob } from \"./Blob\";\nimport { GDIContext } from \"./GDIContext\";\nimport { Helper, WMFJSError } from \"./Helper\";\nimport { WMFRecords } from \"./WMFRecords\";\n\nexport interface IRendererSettings {\n    width: string;\n    height: string;\n    xExt: number;\n    yExt: number;\n    mapMode: number;\n}\n\nexport class Renderer {\n    private _img: WMF;\n\n    constructor(blob: ArrayBuffer) {\n        this.parse(blob);\n        Helper.log(\"WMFJS.Renderer instantiated\");\n    }\n\n    public render(info: IRendererSettings): SVGElement {\n        const svgElement = document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\");\n\n        this._render(new SVG(svgElement), info.mapMode, info.xExt, info.yExt);\n        svgElement.setAttribute(\"viewBox\", [0, 0, info.xExt, info.yExt].join(\" \"));\n        svgElement.setAttribute(\"preserveAspectRatio\", \"none\"); // TODO: MM_ISOTROPIC vs MM_ANISOTROPIC\n        svgElement.setAttribute(\"width\", info.width);\n        svgElement.setAttribute(\"height\", info.height);\n        return svgElement;\n    }\n\n    private parse(blob: ArrayBuffer) {\n        this._img = null;\n\n        const reader = new Blob(blob);\n\n        let type;\n        let size;\n        let placable;\n        let headerstart;\n        const key = reader.readUint32();\n        if (key === 0x9ac6cdd7) {\n            placable = new WMFPlacable(reader);\n            headerstart = reader.pos;\n            type = reader.readUint16();\n            size = reader.readUint16();\n        } else {\n            headerstart = 0;\n            type = key & 0xffff;\n            size = (key >>> 16) & 0xffff;\n        }\n        switch (type) {\n            case Helper.GDI.MetafileType.MEMORYMETAFILE:\n            case Helper.GDI.MetafileType.DISKMETAFILE:\n                if (size === Helper.GDI.METAHEADER_SIZE / 2) {\n                    const version = reader.readUint16();\n                    switch (version) {\n                        case Helper.GDI.MetafileVersion.METAVERSION100:\n                        case Helper.GDI.MetafileVersion.METAVERSION300:\n                            this._img = new WMF(reader, placable, version, headerstart + (size * 2));\n                            break;\n                    }\n                }\n                break;\n        }\n\n        if (this._img == null) {\n            throw new WMFJSError(\"Format not recognized\");\n        }\n    }\n\n    private _render(svg: SVG, mapMode: number, xExt: number, yExt: number) {\n        // See https://www-user.tu-chemnitz.de/~ygu/petzold/ch18b.htm\n        const gdi = new GDIContext(svg);\n        gdi.setViewportExt(xExt, yExt);\n        gdi.setMapMode(mapMode);\n        Helper.log(\"[WMF] BEGIN RENDERING --->\");\n        this._img.render(gdi);\n        Helper.log(\"[WMF] <--- DONE RENDERING\");\n    }\n}\n\nexport class WMFRect16 {\n    private left: number;\n    private top: number;\n    private right: number;\n    private bottom: number;\n\n    constructor(reader: Blob) {\n        this.left = reader.readInt16();\n        this.top = reader.readInt16();\n        this.right = reader.readInt16();\n        this.bottom = reader.readInt16();\n    }\n\n    public toString() {\n        return \"{left: \" + this.left + \", top: \" + this.top + \", right: \" + this.right\n            + \", bottom: \" + this.bottom + \"}\";\n    }\n}\n\nexport class WMFPlacable {\n    private boundingBox: WMFRect16;\n    private unitsPerInch: number;\n\n    constructor(reader: Blob) {\n        reader.skip(2);\n        this.boundingBox = new WMFRect16(reader);\n        this.unitsPerInch = reader.readInt16();\n        reader.skip(4);\n        reader.skip(2); // TODO: checksum\n        Helper.log(\"Got bounding box \" + this.boundingBox + \" and \" + this.unitsPerInch + \" units/inch\");\n    }\n}\n\nexport class WMF {\n    private _version: number;\n    private _hdrsize: number;\n    private _placable: WMFPlacable;\n    private _records: WMFRecords;\n\n    constructor(reader: Blob, placable: WMFPlacable, version: number, hdrsize: number) {\n        this._version = version;\n        this._hdrsize = hdrsize;\n        this._placable = placable;\n        this._records = new WMFRecords(reader, this._hdrsize);\n    }\n\n    public render(gdi: GDIContext) {\n        this._records.play(gdi);\n    }\n}\n","/*\n\nThe MIT License (MIT)\n\nCopyright (c) 2015 Thomas Bluemel\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n\n*/\n\nimport { WMFJSError } from \"./Helper\";\n\nexport class Blob {\n    public pos: number;\n    private blob: Blob | ArrayBuffer;\n    private data: Uint8Array;\n\n    constructor(blob: Blob | ArrayBuffer, offset?: number) {\n        if (blob instanceof Blob) {\n            this.blob = blob.blob;\n            this.data = blob.data;\n            this.pos = offset || blob.pos;\n        } else {\n            this.blob = blob;\n            this.data = new Uint8Array(blob);\n            this.pos = offset || 0;\n        }\n    }\n\n    public eof() {\n        return this.pos >= this.data.length;\n    }\n\n    public seek(newpos: number) {\n        if (newpos < 0 || newpos > this.data.length) {\n            throw new WMFJSError(\"Invalid seek position\");\n        }\n        this.pos = newpos;\n    }\n\n    public skip(cnt: number) {\n        const newPos = this.pos + cnt;\n        if (newPos > this.data.length) {\n            throw new WMFJSError(\"Unexpected end of file\");\n        }\n        this.pos = newPos;\n    }\n\n    public readBinary(cnt: number) {\n        const end = this.pos + cnt;\n        if (end > this.data.length) {\n            throw new WMFJSError(\"Unexpected end of file\");\n        }\n        let ret = \"\";\n        while (cnt-- > 0) {\n            ret += String.fromCharCode(this.data[this.pos++]);\n        }\n        return ret;\n    }\n\n    public readInt8() {\n        if (this.pos + 1 > this.data.length) {\n            throw new WMFJSError(\"Unexpected end of file\");\n        }\n        return this.data[this.pos++];\n    }\n\n    public readUint8() {\n        return this.readInt8() >>> 0;\n    }\n\n    public readInt32() {\n        if (this.pos + 4 > this.data.length) {\n            throw new WMFJSError(\"Unexpected end of file\");\n        }\n        let val = this.data[this.pos++];\n        val |= this.data[this.pos++] << 8;\n        val |= this.data[this.pos++] << 16;\n        val |= this.data[this.pos++] << 24;\n        return val;\n    }\n\n    public readUint32() {\n        return this.readInt32() >>> 0;\n    }\n\n    public readUint16() {\n        if (this.pos + 2 > this.data.length) {\n            throw new WMFJSError(\"Unexpected end of file\");\n        }\n        let val = this.data[this.pos++];\n        val |= this.data[this.pos++] << 8;\n        return val;\n    }\n\n    public readInt16() {\n        let val = this.readUint16();\n        if (val > 32767) {\n            val -= 65536;\n        }\n        return val;\n    }\n\n    public readString(length: number) {\n        if (this.pos + length > this.data.length) {\n            throw new WMFJSError(\"Unexpected end of file\");\n        }\n        let ret = \"\";\n        for (let i = 0; i < length; i++) {\n            ret += String.fromCharCode(this.data[this.pos++] >>> 0);\n        }\n        return ret;\n    }\n\n    public readNullTermString(maxSize: number) {\n        let ret = \"\";\n        if (maxSize > 0) {\n            maxSize--;\n            for (let i = 0; i < maxSize; i++) {\n                if (this.pos + i + 1 > this.data.length) {\n                    throw new WMFJSError(\"Unexpected end of file\");\n                }\n                const byte = this.data[this.pos + i] >>> 0;\n                if (byte === 0) {\n                    break;\n                }\n                ret += String.fromCharCode(byte);\n            }\n        }\n        return ret;\n    }\n}\n","/*\n\nThe MIT License (MIT)\n\nCopyright (c) 2015 Thomas Bluemel\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n\n*/\n\n// tslint:disable-next-line:interface-name\nexport interface WMFJSError {\n    name: string;\n    message: string;\n    stack: string;\n}\n\n// tslint:disable-next-line:variable-name\nexport const WMFJSError = function(this: WMFJSError, message: string) {\n    this.name = \"WMFJSError\";\n    this.message = message;\n    this.stack = (new Error()).stack;\n} as any as new (message: string) => WMFJSError;\nWMFJSError.prototype = new Error();\n\nlet isLoggingEnabled = true;\nexport function loggingEnabled(enabled: boolean) {\n    isLoggingEnabled = enabled;\n}\n\nexport class Helper {\n    public static GDI = {\n        METAHEADER_SIZE: 18,\n        BITMAPINFOHEADER_SIZE: 40,\n        BITMAPCOREHEADER_SIZE: 12,\n        MetafileType: {\n            MEMORYMETAFILE: 1,\n            DISKMETAFILE: 2,\n        },\n        MetafileVersion: {\n            METAVERSION100: 0x100,\n            METAVERSION300: 0x300,\n        },\n        RecordType: {\n            META_EOF: 0x0000,\n            META_REALIZEPALETTE: 0x0035,\n            META_SETPALENTRIES: 0x0037,\n            META_SETBKMODE: 0x0102,\n            META_SETMAPMODE: 0x0103,\n            META_SETROP2: 0x0104,\n            META_SETRELABS: 0x0105,\n            META_SETPOLYFILLMODE: 0x0106,\n            META_SETSTRETCHBLTMODE: 0x0107,\n            META_SETTEXTCHAREXTRA: 0x0108,\n            META_RESTOREDC: 0x0127,\n            META_RESIZEPALETTE: 0x0139,\n            META_DIBCREATEPATTERNBRUSH: 0x0142,\n            META_SETLAYOUT: 0x0149,\n            META_SETBKCOLOR: 0x0201,\n            META_SETTEXTCOLOR: 0x0209,\n            META_OFFSETVIEWPORTORG: 0x0211,\n            META_LINETO: 0x0213,\n            META_MOVETO: 0x0214,\n            META_OFFSETCLIPRGN: 0x0220,\n            META_FILLREGION: 0x0228,\n            META_SETMAPPERFLAGS: 0x0231,\n            META_SELECTPALETTE: 0x0234,\n            META_POLYGON: 0x0324,\n            META_POLYLINE: 0x0325,\n            META_SETTEXTJUSTIFICATION: 0x020a,\n            META_SETWINDOWORG: 0x020b,\n            META_SETWINDOWEXT: 0x020c,\n            META_SETVIEWPORTORG: 0x020d,\n            META_SETVIEWPORTEXT: 0x020e,\n            META_OFFSETWINDOWORG: 0x020f,\n            META_SCALEWINDOWEXT: 0x0410,\n            META_SCALEVIEWPORTEXT: 0x0412,\n            META_EXCLUDECLIPRECT: 0x0415,\n            META_INTERSECTCLIPRECT: 0x0416,\n            META_ELLIPSE: 0x0418,\n            META_FLOODFILL: 0x0419,\n            META_FRAMEREGION: 0x0429,\n            META_ANIMATEPALETTE: 0x0436,\n            META_TEXTOUT: 0x0521,\n            META_POLYPOLYGON: 0x0538,\n            META_EXTFLOODFILL: 0x0548,\n            META_RECTANGLE: 0x041b,\n            META_SETPIXEL: 0x041f,\n            META_ROUNDRECT: 0x061c,\n            META_PATBLT: 0x061d,\n            META_SAVEDC: 0x001e,\n            META_PIE: 0x081a,\n            META_STRETCHBLT: 0x0b23,\n            META_ESCAPE: 0x0626,\n            META_INVERTREGION: 0x012a,\n            META_PAINTREGION: 0x012b,\n            META_SELECTCLIPREGION: 0x012c,\n            META_SELECTOBJECT: 0x012d,\n            META_SETTEXTALIGN: 0x012e,\n            META_ARC: 0x0817,\n            META_CHORD: 0x0830,\n            META_BITBLT: 0x0922,\n            META_EXTTEXTOUT: 0x0a32,\n            META_SETDIBTODEV: 0x0d33,\n            META_DIBBITBLT: 0x0940,\n            META_DIBSTRETCHBLT: 0x0b41,\n            META_STRETCHDIB: 0x0f43,\n            META_DELETEOBJECT: 0x01f0,\n            META_CREATEPALETTE: 0x00f7,\n            META_CREATEPATTERNBRUSH: 0x01f9,\n            META_CREATEPENINDIRECT: 0x02fa,\n            META_CREATEFONTINDIRECT: 0x02fb,\n            META_CREATEBRUSHINDIRECT: 0x02fc,\n            META_CREATEREGION: 0x06ff,\n        },\n        MetafileEscapes: {\n            NEWFRAME: 0x0001,\n            ABORTDOC: 0x0002,\n            NEXTBAND: 0x0003,\n            SETCOLORTABLE: 0x0004,\n            GETCOLORTABLE: 0x0005,\n            FLUSHOUT: 0x0006,\n            DRAFTMODE: 0x0007,\n            QUERYESCSUPPORT: 0x0008,\n            SETABORTPROC: 0x0009,\n            STARTDOC: 0x000a,\n            ENDDOC: 0x000b,\n            GETPHYSPAGESIZE: 0x000c,\n            GETPRINTINGOFFSET: 0x000d,\n            GETSCALINGFACTOR: 0x000e,\n            META_ESCAPE_ENHANCED_METAFILE: 0x000f,\n            SETPENWIDTH: 0x0010,\n            SETCOPYCOUNT: 0x0011,\n            SETPAPERSOURCE: 0x0012,\n            PASSTHROUGH: 0x0013,\n            GETTECHNOLOGY: 0x0014,\n            SETLINECAP: 0x0015,\n            SETLINEJOIN: 0x0016,\n            SETMITERLIMIT: 0x0017,\n            BANDINFO: 0x0018,\n            DRAWPATTERNRECT: 0x0019,\n            GETVECTORPENSIZE: 0x001a,\n            GETVECTORBRUSHSIZE: 0x001b,\n            ENABLEDUPLEX: 0x001c,\n            GETSETPAPERBINS: 0x001d,\n            GETSETPRINTORIENT: 0x001e,\n            ENUMPAPERBINS: 0x001f,\n            SETDIBSCALING: 0x0020,\n            EPSPRINTING: 0x0021,\n            ENUMPAPERMETRICS: 0x0022,\n            GETSETPAPERMETRICS: 0x0023,\n            POSTSCRIPT_DATA: 0x0025,\n            POSTSCRIPT_IGNORE: 0x0026,\n            GETDEVICEUNITS: 0x002a,\n            GETEXTENDEDTEXTMETRICS: 0x0100,\n            GETPAIRKERNTABLE: 0x0102,\n            EXTTEXTOUT: 0x0200,\n            GETFACENAME: 0x0201,\n            DOWNLOADFACE: 0x0202,\n            METAFILE_DRIVER: 0x0801,\n            QUERYDIBSUPPORT: 0x0c01,\n            BEGIN_PATH: 0x1000,\n            CLIP_TO_PATH: 0x1001,\n            END_PATH: 0x1002,\n            OPEN_CHANNEL: 0x100e,\n            DOWNLOADHEADER: 0x100f,\n            CLOSE_CHANNEL: 0x1010,\n            POSTSCRIPT_PASSTHROUGH: 0x1013,\n            ENCAPSULATED_POSTSCRIPT: 0x1014,\n            POSTSCRIPT_IDENTIFY: 0x1015,\n            POSTSCRIPT_INJECTION: 0x1016,\n            CHECKJPEGFORMAT: 0x1017,\n            CHECKPNGFORMAT: 0x1018,\n            GET_PS_FEATURESETTING: 0x1019,\n            MXDC_ESCAPE: 0x101a,\n            SPCLPASSTHROUGH2: 0x11d8,\n        },\n        MapMode: {\n            MM_TEXT: 1,\n            MM_LOMETRIC: 2,\n            MM_HIMETRIC: 3,\n            MM_LOENGLISH: 4,\n            MM_HIENGLISH: 5,\n            MM_TWIPS: 6,\n            MM_ISOTROPIC: 7,\n            MM_ANISOTROPIC: 8,\n        },\n        StretchMode: {\n            BLACKONWHITE: 1,\n            WHITEONBLACK: 2,\n            COLORONCOLOR: 3,\n            HALFTONE: 4,\n        },\n        TextAlignmentMode: {\n            TA_UPDATECP: 1,\n            TA_RIGHT: 2,\n            TA_CENTER: 6,\n            TA_BOTTOM: 8,\n            TA_BASELINE: 24,\n            TA_RTLREADING: 256,\n        },\n        MixMode: {\n            TRANSPARENT: 1,\n            OPAQUE: 2,\n        },\n        VerticalTextAlignmentMode: {\n            VTA_BOTTOM: 2,\n            VTA_CENTER: 6,\n            VTA_LEFT: 8,\n            VTA_BASELINE: 24,\n        },\n        BrushStyle: {\n            BS_SOLID: 0,\n            BS_NULL: 1,\n            BS_HATCHED: 2,\n            BS_PATTERN: 3,\n            BS_INDEXED: 4,\n            BS_DIBPATTERN: 5,\n            BS_DIBPATTERNPT: 6,\n            BS_PATTERN8X8: 7,\n            BS_DIBPATTERN8X8: 8,\n            BS_MONOPATTERN: 9,\n        },\n        PenStyle: {\n            PS_SOLID: 0,\n            PS_DASH: 1,\n            PS_DOT: 2,\n            PS_DASHDOT: 3,\n            PS_DASHDOTDOT: 4,\n            PS_NULL: 5,\n            PS_INSIDEFRAME: 6,\n            PS_USERSTYLE: 7,\n            PS_ALTERNATE: 8,\n            PS_ENDCAP_SQUARE: 256,\n            PS_ENDCAP_FLAT: 512,\n            PS_JOIN_BEVEL: 4096,\n            PS_JOIN_MITER: 8192,\n        },\n        PolyFillMode: {\n            ALTERNATE: 1,\n            WINDING: 2,\n        },\n        ColorUsage: {\n            DIB_RGB_COLORS: 0,\n            DIB_PAL_COLORS: 1,\n            DIB_PAL_INDICES: 2,\n        },\n        PaletteEntryFlag: {\n            PC_RESERVED: 1,\n            PC_EXPLICIT: 2,\n            PC_NOCOLLAPSE: 4,\n        },\n        BitmapCompression: {\n            BI_RGB: 0,\n            BI_RLE8: 1,\n            BI_RLE4: 2,\n            BI_BITFIELDS: 3,\n            BI_JPEG: 4,\n            BI_PNG: 5,\n        },\n    };\n    public static _uniqueId = 0;\n\n    public static log(message: string) {\n        if (isLoggingEnabled) {\n            // tslint:disable-next-line:no-console\n            console.log(message);\n        }\n    }\n\n    public static _makeUniqueId(prefix: string) {\n        return \"wmfjs_\" + prefix + (this._uniqueId++);\n    }\n\n    public static _writeUint32Val(uint8arr: Uint8Array, pos: number, val: number) {\n        uint8arr[pos++] = val & 0xff;\n        uint8arr[pos++] = (val >>> 8) & 0xff;\n        uint8arr[pos++] = (val >>> 16) & 0xff;\n        uint8arr[pos++] = (val >>> 24) & 0xff;\n    }\n\n    public static _blobToBinary(blob: Uint8Array) {\n        let ret = \"\";\n        const len = blob.length;\n        for (let i = 0; i < len; i++) {\n            ret += String.fromCharCode(blob[i]);\n        }\n        return ret;\n    }\n}\n","/*\n\nThe MIT License (MIT)\n\nCopyright (c) 2015 Thomas Bluemel\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n\n*/\n\nimport { SVG } from \"../util/SVG\";\nimport { DIBitmap } from \"./Bitmap\";\nimport { Blob } from \"./Blob\";\nimport { Helper, WMFJSError } from \"./Helper\";\nimport { Obj, PointS, Rect } from \"./Primitives\";\nimport { CreateSimpleRegion, Region } from \"./Region\";\nimport { Brush, ColorRef, Font, Palette, Pen } from \"./Style\";\n\nexport interface ISelectedStyle {\n    brush?: Brush;\n    pen?: Pen;\n    font?: Font;\n    palette?: Palette;\n    region?: Region;\n    [key: string]: Obj;\n}\n\nexport class GDIContextState {\n    public _svggroup: SVGElement;\n    public _svgclipChanged: boolean;\n    public _svgtextbkfilter: SVGFilterElement;\n    public mapmode: number;\n    public stretchmode: number;\n    public textalign: number;\n    public bkmode: number;\n    public textcolor: ColorRef;\n    public bkcolor: ColorRef;\n    public polyfillmode: number;\n    public wx: number;\n    public wy: number;\n    public ww: number;\n    public wh: number;\n    public vx: number;\n    public vy: number;\n    public vw: number;\n    public vh: number;\n    public x: number;\n    public y: number;\n    public clip: Region;\n    public ownclip: boolean;\n    public selected: ISelectedStyle;\n\n    constructor(copy: GDIContextState, defObjects?: ISelectedStyle) {\n        if (copy != null) {\n            this._svggroup = copy._svggroup;\n            this._svgclipChanged = copy._svgclipChanged;\n            this._svgtextbkfilter = copy._svgtextbkfilter;\n            this.mapmode = copy.mapmode;\n            this.stretchmode = copy.stretchmode;\n            this.textalign = copy.textalign;\n            this.bkmode = copy.bkmode;\n            this.textcolor = copy.textcolor.clone();\n            this.bkcolor = copy.bkcolor.clone();\n            this.polyfillmode = copy.polyfillmode;\n            this.wx = copy.wx;\n            this.wy = copy.wy;\n            this.ww = copy.ww;\n            this.wh = copy.wh;\n            this.vx = copy.vx;\n            this.vy = copy.vy;\n            this.vw = copy.vw;\n            this.vh = copy.vh;\n            this.x = copy.x;\n            this.y = copy.y;\n\n            this.clip = copy.clip;\n            this.ownclip = false;\n\n            this.selected = {};\n            for (const type in copy.selected) {\n                this.selected[type] = copy.selected[type];\n            }\n        } else {\n            this._svggroup = null;\n            this._svgclipChanged = false;\n            this._svgtextbkfilter = null;\n            this.mapmode = Helper.GDI.MapMode.MM_ANISOTROPIC;\n            this.stretchmode = Helper.GDI.StretchMode.COLORONCOLOR;\n            this.textalign = 0; // TA_LEFT | TA_TOP | TA_NOUPDATECP\n            this.bkmode = Helper.GDI.MixMode.OPAQUE;\n            this.textcolor = new ColorRef(null, 0, 0, 0);\n            this.bkcolor = new ColorRef(null, 255, 255, 255);\n            this.polyfillmode = Helper.GDI.PolyFillMode.ALTERNATE;\n            this.wx = 0;\n            this.wy = 0;\n            this.ww = 0;\n            this.wh = 0;\n            this.vx = 0;\n            this.vy = 0;\n            this.vw = 0;\n            this.vh = 0;\n            this.x = 0;\n            this.y = 0;\n\n            this.clip = null;\n            this.ownclip = false;\n\n            this.selected = {};\n            for (const type in defObjects) {\n                const defObj = defObjects[type];\n                this.selected[type] = defObj != null ? defObj.clone() : null;\n            }\n        }\n    }\n}\n\nexport class GDIContext {\n    private _svg: SVG;\n    private _svgdefs: any;\n    private _svgPatterns: {[key: string]: Brush};\n    private _svgClipPaths: {[key: string]: Region};\n    private defObjects: ISelectedStyle;\n    private state: GDIContextState;\n    private statestack: GDIContextState[];\n    private objects: {[key: string]: Obj};\n\n    constructor(svg: SVG) {\n        this._svg = svg;\n        this._svgdefs = null;\n        this._svgPatterns = {};\n        this._svgClipPaths = {};\n\n        this.defObjects = {\n            brush: new Brush(null, null),\n            pen: new Pen(null, Helper.GDI.PenStyle.PS_SOLID, new PointS(null, 1, 1), new ColorRef(null, 0, 0, 0), 0, 0),\n            font: new Font(null, null),\n            palette: null,\n            region: null,\n        };\n\n        this.state = new GDIContextState(null, this.defObjects);\n        this.statestack = [this.state];\n        this.objects = {};\n    }\n\n    public setMapMode(mode: number) {\n        Helper.log(\"[gdi] setMapMode: mode=\" + mode);\n        this.state.mapmode = mode;\n        this.state._svggroup = null;\n    }\n\n    public setWindowOrg(x: number, y: number) {\n        Helper.log(\"[gdi] setWindowOrg: x=\" + x + \" y=\" + y);\n        this.state.wx = x;\n        this.state.wy = y;\n        this.state._svggroup = null;\n    }\n\n    public setWindowExt(x: number, y: number) {\n        Helper.log(\"[gdi] setWindowExt: x=\" + x + \" y=\" + y);\n        this.state.ww = x;\n        this.state.wh = y;\n        this.state._svggroup = null;\n    }\n\n    public offsetWindowOrg(offX: number, offY: number) {\n        Helper.log(\"[gdi] offsetWindowOrg: offX=\" + offX + \" offY=\" + offY);\n        this.state.wx += offX;\n        this.state.wy += offY;\n        this.state._svggroup = null;\n    }\n\n    public setViewportOrg(x: number, y: number) {\n        Helper.log(\"[gdi] setViewportOrg: x=\" + x + \" y=\" + y);\n        this.state.vx = x;\n        this.state.vy = y;\n        this.state._svggroup = null;\n    }\n\n    public setViewportExt(x: number, y: number) {\n        Helper.log(\"[gdi] setViewportExt: x=\" + x + \" y=\" + y);\n        this.state.vw = x;\n        this.state.vh = y;\n        this.state._svggroup = null;\n    }\n\n    public offsetViewportOrg(offX: number, offY: number) {\n        Helper.log(\"[gdi] offsetViewportOrg: offX=\" + offX + \" offY=\" + offY);\n        this.state.vx += offX;\n        this.state.vy += offY;\n        this.state._svggroup = null;\n    }\n\n    public saveDC() {\n        Helper.log(\"[gdi] saveDC\");\n        const prevstate = this.state;\n        this.state = new GDIContextState(this.state);\n        this.statestack.push(prevstate);\n        this.state._svggroup = null;\n    }\n\n    public restoreDC(saved: number) {\n        Helper.log(\"[gdi] restoreDC: saved=\" + saved);\n        if (this.statestack.length > 1) {\n            if (saved === -1) {\n                this.state = this.statestack.pop();\n            } else if (saved < -1) {\n                throw new WMFJSError(\"restoreDC: relative restore not implemented\");\n            } else if (saved > 1) {\n                throw new WMFJSError(\"restoreDC: absolute restore not implemented\");\n            }\n        } else {\n            throw new WMFJSError(\"No saved contexts\");\n        }\n\n        this.state._svggroup = null;\n    }\n\n    public escape(func: number, blob: Blob, offset: number, count: number) {\n        Helper.log(\"[gdi] escape: func=\" + func + \" offset=\" + offset + \" count=\" + count);\n    }\n\n    public setStretchBltMode(stretchMode: number) {\n        Helper.log(\"[gdi] setStretchBltMode: stretchMode=\" + stretchMode);\n    }\n\n    public stretchDib(srcX: number, srcY: number, srcW: number, srcH: number,\n                      dstX: number, dstY: number, dstW: number, dstH: number,\n                      rasterOp: number, colorUsage: number, dib: DIBitmap) {\n        Helper.log(\"[gdi] stretchDib: srcX=\" + srcX + \" srcY=\" + srcY + \" srcW=\" + srcW + \" srcH=\" + srcH\n            + \" dstX=\" + dstX + \" dstY=\" + dstY + \" dstW=\" + dstW + \" dstH=\" + dstH\n            + \" rasterOp=0x\" + rasterOp.toString(16));\n        srcX = this._todevX(srcX);\n        srcY = this._todevY(srcY);\n        srcW = this._todevW(srcW);\n        srcH = this._todevH(srcH);\n        dstX = this._todevX(dstX);\n        dstY = this._todevY(dstY);\n        dstW = this._todevW(dstW);\n        dstH = this._todevH(dstH);\n        Helper.log(\"[gdi] stretchDib: TRANSLATED: srcX=\" + srcX + \" srcY=\" + srcY + \" srcW=\" + srcW + \" srcH=\" + srcH\n            + \" dstX=\" + dstX + \" dstY=\" + dstY + \" dstW=\" + dstW + \" dstH=\" + dstH\n            + \" rasterOp=0x\" + rasterOp.toString(16) + \" colorUsage=0x\" + colorUsage.toString(16));\n        this._pushGroup();\n        this._svg.image(this.state._svggroup, dstX, dstY, dstW, dstH, dib.base64ref());\n    }\n\n    public stretchDibBits(srcX: number, srcY: number, srcW: number, srcH: number,\n                          dstX: number, dstY: number, dstW: number, dstH: number,\n                          rasterOp: number, dib: DIBitmap) {\n        Helper.log(\"[gdi] stretchDibBits: srcX=\" + srcX + \" srcY=\" + srcY + \" srcW=\" + srcW + \" srcH=\" + srcH\n            + \" dstX=\" + dstX + \" dstY=\" + dstY + \" dstW=\" + dstW + \" dstH=\" + dstH\n            + \" rasterOp=0x\" + rasterOp.toString(16));\n        srcX = this._todevX(srcX);\n        srcY = this._todevY(srcY);\n        srcW = this._todevW(srcW);\n        srcH = this._todevH(srcH);\n        dstX = this._todevX(dstX);\n        dstY = this._todevY(dstY);\n        dstW = this._todevW(dstW);\n        dstH = this._todevH(dstH);\n        Helper.log(\"[gdi] stretchDibBits: TRANSLATED:\"\n            + \" srcX=\" + srcX + \" srcY=\" + srcY + \" srcW=\" + srcW + \" srcH=\" + srcH\n            + \" dstX=\" + dstX + \" dstY=\" + dstY + \" dstW=\" + dstW + \" dstH=\" + dstH\n            + \" rasterOp=0x\" + rasterOp.toString(16));\n        this._pushGroup();\n        this._svg.image(this.state._svggroup, dstX, dstY, dstW, dstH, dib.base64ref());\n    }\n\n    public rectangle(rect: Rect, rw: number, rh: number) {\n        Helper.log(\"[gdi] rectangle: rect=\" + rect.toString() + \" with pen \" + this.state.selected.pen.toString()\n            + \" and brush \" + this.state.selected.brush.toString());\n        const bottom = this._todevY(rect.bottom);\n        const right = this._todevX(rect.right);\n        const top = this._todevY(rect.top);\n        const left = this._todevX(rect.left);\n        rw = this._todevH(rw);\n        rh = this._todevH(rh);\n        Helper.log(\"[gdi] rectangle: TRANSLATED: bottom=\" + bottom + \" right=\" + right + \" top=\" + top\n            + \" left=\" + left + \" rh=\" + rh + \" rw=\" + rw);\n        this._pushGroup();\n\n        const opts = this._applyOpts(null, true, true, false);\n        this._svg.rect(this.state._svggroup, left, top, right - left, bottom - top, rw / 2, rh / 2, opts);\n    }\n\n    public textOut(x: number, y: number, text: string) {\n        Helper.log(\"[gdi] textOut: x=\" + x + \" y=\" + y + \" text=\" + text\n            + \" with font \" + this.state.selected.font.toString());\n        x = this._todevX(x);\n        y = this._todevY(y);\n        Helper.log(\"[gdi] textOut: TRANSLATED: x=\" + x + \" y=\" + y);\n        this._pushGroup();\n\n        const opts = this._applyOpts(null, false, false, true);\n        if (this.state.selected.font.escapement !== 0) {\n            opts.transform = \"rotate(\" + [(-this.state.selected.font.escapement / 10), x, y] + \")\";\n            opts.style = \"dominant-baseline: middle; text-anchor: start;\";\n        }\n        if (this.state.bkmode === Helper.GDI.MixMode.OPAQUE) {\n            if (this.state._svgtextbkfilter == null) {\n                const filterId = Helper._makeUniqueId(\"f\");\n                const filter = this._svg.filter(this._getSvgDef(), filterId, 0, 0, 1, 1);\n                this._svg.filters.flood(filter, null, \"#\" + this.state.bkcolor.toHex(), 1.0);\n                this._svg.filters.composite(filter, null, null, \"SourceGraphic\");\n                this.state._svgtextbkfilter = filter;\n            }\n\n            opts.filter = \"url(#\" + this.state._svgtextbkfilter.id + \")\";\n        }\n        this._svg.text(this.state._svggroup, x, y, text, opts);\n    }\n\n    public extTextOut(x: number, y: number, text: string, fwOpts: number, rect: Rect, dx: number[]) {\n        Helper.log(\"[gdi] extTextOut: x=\" + x + \" y=\" + y + \" text=\" + text\n            + \" with font \" + this.state.selected.font.toString());\n        x = this._todevX(x);\n        y = this._todevY(y);\n        Helper.log(\"[gdi] extTextOut: TRANSLATED: x=\" + x + \" y=\" + y);\n        this._pushGroup();\n\n        const opts = this._applyOpts(null, false, false, true);\n        if (this.state.selected.font.escapement !== 0) {\n            opts.transform = \"rotate(\" + [(-this.state.selected.font.escapement / 10), x, y] + \")\";\n            opts.style = \"dominant-baseline: middle; text-anchor: start;\";\n        }\n        if (this.state.bkmode === Helper.GDI.MixMode.OPAQUE) {\n            if (this.state._svgtextbkfilter == null) {\n                const filterId = Helper._makeUniqueId(\"f\");\n                const filter = this._svg.filter(this._getSvgDef(), filterId, 0, 0, 1, 1);\n                this._svg.filters.flood(filter, null, \"#\" + this.state.bkcolor.toHex(), 1.0);\n                this._svg.filters.composite(filter, null, null, \"SourceGraphic\");\n                this.state._svgtextbkfilter = filter;\n            }\n\n            opts.filter = \"url(#\" + this.state._svgtextbkfilter.id + \")\";\n        }\n        this._svg.text(this.state._svggroup, x, y, text, opts);\n    }\n\n    public lineTo(x: number, y: number) {\n        Helper.log(\"[gdi] lineTo: x=\" + x + \" y=\" + y + \" with pen \" + this.state.selected.pen.toString());\n        const toX = this._todevX(x);\n        const toY = this._todevY(y);\n        const fromX = this._todevX(this.state.x);\n        const fromY = this._todevY(this.state.y);\n\n        // Update position\n        this.state.x = x;\n        this.state.y = y;\n\n        Helper.log(\"[gdi] lineTo: TRANSLATED: toX=\" + toX + \" toY=\" + toY + \" fromX=\" + fromX + \" fromY=\" + fromY);\n        this._pushGroup();\n\n        const opts = this._applyOpts(null, true, false, false);\n        this._svg.line(this.state._svggroup, fromX, fromY, toX, toY, opts);\n    }\n\n    public moveTo(x: number, y: number) {\n        Helper.log(\"[gdi] moveTo: x=\" + x + \" y=\" + y);\n        this.state.x = x;\n        this.state.y = y;\n    }\n\n    public polygon(points: PointS[], first: boolean) {\n        Helper.log(\"[gdi] polygon: points=\" + points + \" with pen \" + this.state.selected.pen.toString()\n            + \" and brush \" + this.state.selected.brush.toString());\n        const pts = [];\n        for (let i = 0; i < points.length; i++) {\n            const point = points[i];\n            pts.push([this._todevX(point.x), this._todevY(point.y)]);\n        }\n        Helper.log(\"[gdi] polygon: TRANSLATED: pts=\" + pts);\n        if (first) {\n            this._pushGroup();\n        }\n        const opts = {\n            \"fill-rule\": this.state.polyfillmode === Helper.GDI.PolyFillMode.ALTERNATE ? \"evenodd\" : \"nonzero\",\n        };\n        this._applyOpts(opts, true, true, false);\n        this._svg.polygon(this.state._svggroup, pts, opts);\n    }\n\n    public polyPolygon(polygons: PointS[][]) {\n        Helper.log(\"[gdi] polyPolygon: polygons.length=\" + polygons.length\n            + \" with pen \" + this.state.selected.pen.toString()\n            + \" and brush \" + this.state.selected.brush.toString());\n\n        const cnt = polygons.length;\n        for (let i = 0; i < cnt; i++) {\n            this.polygon(polygons[i], i === 0);\n        }\n    }\n\n    public polyline(points: PointS[]) {\n        Helper.log(\"[gdi] polyline: points=\" + points + \" with pen \" + this.state.selected.pen.toString());\n        const pts = [];\n        for (let i = 0; i < points.length; i++) {\n            const point = points[i];\n            pts.push([this._todevX(point.x), this._todevY(point.y)]);\n        }\n        Helper.log(\"[gdi] polyline: TRANSLATED: pts=\" + pts);\n        this._pushGroup();\n        const opts = this._applyOpts({fill: \"none\"}, true, false, false);\n        this._svg.polyline(this.state._svggroup, pts, opts);\n    }\n\n    public ellipse(rect: Rect) {\n        Helper.log(\"[gdi] ellipse: rect=\" + rect.toString() + \" with pen \" + this.state.selected.pen.toString()\n            + \" and brush \" + this.state.selected.brush.toString());\n        const bottom = this._todevY(rect.bottom);\n        const right = this._todevX(rect.right);\n        const top = this._todevY(rect.top);\n        const left = this._todevX(rect.left);\n        Helper.log(\"[gdi] ellipse: TRANSLATED: bottom=\" + bottom + \" right=\" + right + \" top=\" + top + \" left=\" + left);\n        this._pushGroup();\n        const width2 = (right - left) / 2;\n        const height2 = (bottom - top) / 2;\n        const opts = this._applyOpts(null, true, true, false);\n        this._svg.ellipse(this.state._svggroup, left + width2, top + height2, width2, height2, opts);\n    }\n\n    public excludeClipRect(rect: Rect) {\n        Helper.log(\"[gdi] excludeClipRect: rect=\" + rect.toString());\n        this._getClipRgn().subtract(rect);\n    }\n\n    public intersectClipRect(rect: Rect) {\n        Helper.log(\"[gdi] intersectClipRect: rect=\" + rect.toString());\n        this._getClipRgn().intersect(rect);\n    }\n\n    public offsetClipRgn(offX: number, offY: number) {\n        Helper.log(\"[gdi] offsetClipRgn: offX=\" + offX + \" offY=\" + offY);\n        this._getClipRgn().offset(offX, offY);\n    }\n\n    public setTextAlign(textAlignmentMode: number) {\n        Helper.log(\"[gdi] setTextAlign: textAlignmentMode=0x\" + textAlignmentMode.toString(16));\n        this.state.textalign = textAlignmentMode;\n    }\n\n    public setBkMode(bkMode: number) {\n        Helper.log(\"[gdi] setBkMode: bkMode=0x\" + bkMode.toString(16));\n        this.state.bkmode = bkMode;\n    }\n\n    public setTextColor(textColor: ColorRef) {\n        Helper.log(\"[gdi] setTextColor: textColor=\" + textColor.toString());\n        this.state.textcolor = textColor;\n    }\n\n    public setBkColor(bkColor: ColorRef) {\n        Helper.log(\"[gdi] setBkColor: bkColor=\" + bkColor.toString());\n        this.state.bkcolor = bkColor;\n        this.state._svgtextbkfilter = null;\n    }\n\n    public setPolyFillMode(polyFillMode: number) {\n        Helper.log(\"[gdi] setPolyFillMode: polyFillMode=\" + polyFillMode);\n        this.state.polyfillmode = polyFillMode;\n    }\n\n    public createBrush(brush: Brush) {\n        const idx = this._storeObject(brush);\n        Helper.log(\"[gdi] createBrush: brush=\" + brush.toString() + \" with handle \" + idx);\n    }\n\n    public createFont(font: Font) {\n        const idx = this._storeObject(font);\n        Helper.log(\"[gdi] createFont: font=\" + font.toString() + \" with handle \" + idx);\n    }\n\n    public createPen(pen: Pen) {\n        const idx = this._storeObject(pen);\n        Helper.log(\"[gdi] createPen: pen=\" + pen.toString() + \" width handle \" + idx);\n    }\n\n    public createPalette(palette: Palette) {\n        const idx = this._storeObject(palette);\n        Helper.log(\"[gdi] createPalette: palette=\" + palette.toString() + \" width handle \" + idx);\n    }\n\n    public createRegion(region: Region) {\n        const idx = this._storeObject(region);\n        Helper.log(\"[gdi] createRegion: region=\" + region.toString() + \" width handle \" + idx);\n    }\n\n    public createPatternBrush(patternBrush: Brush) {\n        const idx = this._storeObject(patternBrush);\n        Helper.log(\"[gdi] createRegion: region=\" + patternBrush.toString() + \" width handle \" + idx);\n    }\n\n    public selectObject(objIdx: number, checkType: string) {\n        const obj = this._getObject(objIdx);\n        if (obj != null && (checkType == null || obj.type === checkType)) {\n            this._selectObject(obj);\n            Helper.log(\"[gdi] selectObject: objIdx=\" + objIdx\n                + (obj ? \" selected \" + obj.type + \": \" + obj.toString() : \"[invalid index]\"));\n        } else {\n            Helper.log(\"[gdi] selectObject: objIdx=\" + objIdx\n                + (obj ? \" invalid object type: \" + obj.type : \"[invalid index]\"));\n        }\n    }\n\n    public deleteObject(objIdx: number) {\n        const ret = this._deleteObject(objIdx);\n        Helper.log(\"[gdi] deleteObject: objIdx=\" + objIdx + (ret ? \" deleted object\" : \"[invalid index]\"));\n    }\n\n    private _pushGroup() {\n        if (this.state._svggroup == null || this.state._svgclipChanged) {\n            this.state._svgclipChanged = false;\n            this.state._svgtextbkfilter = null;\n\n            const settings: any = {\n                viewBox: [this.state.vx, this.state.vy, this.state.vw, this.state.vh].join(\" \"),\n                preserveAspectRatio: \"none\",\n            };\n            if (this.state.clip != null) {\n                Helper.log(\"[gdi] new svg x=\" + this.state.vx + \" y=\" + this.state.vy\n                    + \" width=\" + this.state.vw + \" height=\" + this.state.vh + \" with clipping\");\n                settings[\"clip-path\"] = \"url(#\" + this._getSvgClipPathForRegion(this.state.clip) + \")\";\n            } else {\n                Helper.log(\"[gdi] new svg x=\" + this.state.vx + \" y=\" + this.state.vy\n                    + \" width=\" + this.state.vw + \" height=\" + this.state.vh + \" without clipping\");\n            }\n            this.state._svggroup = this._svg.svg(this.state._svggroup,\n                this.state.vx, this.state.vy, this.state.vw, this.state.vh, settings);\n        }\n    }\n\n    private _storeObject(obj: Obj) {\n        let i = 0;\n        while (this.objects[i.toString()] != null && i <= 65535) {\n            i++;\n        }\n        if (i > 65535) {\n            Helper.log(\"[gdi] Too many objects!\");\n            return -1;\n        }\n\n        this.objects[i.toString()] = obj;\n        return i;\n    }\n\n    private _getObject(objIdx: number) {\n        const obj = this.objects[objIdx.toString()];\n        if (obj == null) {\n            Helper.log(\"[gdi] No object with handle \" + objIdx);\n        }\n        return obj;\n    }\n\n    private _getSvgDef() {\n        if (this._svgdefs == null) {\n            this._svgdefs = this._svg.defs();\n        }\n        return this._svgdefs;\n    }\n\n    private _getSvgClipPathForRegion(region: Region) {\n        for (const existingId in this._svgClipPaths) {\n            const rgn = this._svgClipPaths[existingId];\n            if (rgn === region) {\n                return existingId;\n            }\n        }\n\n        const id = Helper._makeUniqueId(\"c\");\n        const sclip = this._svg.clipPath(this._getSvgDef(), id, \"userSpaceOnUse\");\n        switch (region.complexity) {\n            case 1:\n                this._svg.rect(sclip, this._todevX(region.bounds.left), this._todevY(region.bounds.top),\n                    this._todevW(region.bounds.right - region.bounds.left),\n                    this._todevH(region.bounds.bottom - region.bounds.top),\n                    { fill: \"black\", strokeWidth: 0 });\n                break;\n            case 2:\n                for (let i = 0; i < region.scans.length; i++) {\n                    const scan = region.scans[i];\n                    for (let j = 0; j < scan.scanlines.length; j++) {\n                        const scanline = scan.scanlines[j];\n                        this._svg.rect(sclip, this._todevX(scanline.left), this._todevY(scan.top),\n                            this._todevW(scanline.right - scanline.left), this._todevH(scan.bottom - scan.top),\n                            { fill: \"black\", strokeWidth: 0 });\n                    }\n                }\n                break;\n        }\n        this._svgClipPaths[id] = region;\n        return id;\n    }\n\n    private _getSvgPatternForBrush(brush: Brush) {\n        for (const existingId in this._svgPatterns) {\n            const pat = this._svgPatterns[existingId];\n            if (pat === brush) {\n                return existingId;\n            }\n        }\n\n        let width;\n        let height;\n        let img;\n        switch (brush.style) {\n            case Helper.GDI.BrushStyle.BS_PATTERN:\n                width = brush.pattern.getWidth();\n                height = brush.pattern.getHeight();\n                break;\n            case Helper.GDI.BrushStyle.BS_DIBPATTERNPT:\n                width = brush.dibpatternpt.getWidth();\n                height = brush.dibpatternpt.getHeight();\n                img = brush.dibpatternpt.base64ref();\n                break;\n            default:\n                throw new WMFJSError(\"Invalid brush style\");\n        }\n\n        const id = Helper._makeUniqueId(\"p\");\n        const spat = this._svg.pattern(this._getSvgDef(), id, 0, 0, width, height, {patternUnits: \"userSpaceOnUse\"});\n        this._svg.image(spat, 0, 0, width, height, img);\n        this._svgPatterns[id] = brush;\n        return id;\n    }\n\n    private _selectObject(obj: Obj) {\n        this.state.selected[obj.type] = obj;\n        if (obj.type === \"region\") {\n            this.state._svgclipChanged = true;\n        }\n    }\n\n    private _deleteObject(objIdx: number) {\n        const obj = this.objects[objIdx.toString()];\n        if (obj != null) {\n            for (let i = 0; i < this.statestack.length; i++) {\n                const state = this.statestack[i];\n                if (state.selected[obj.type] === obj) {\n                    state.selected[obj.type] = this.defObjects[obj.type].clone();\n                }\n            }\n            delete this.objects[objIdx.toString()];\n            return true;\n        }\n\n        Helper.log(\"[gdi] Cannot delete object with invalid handle \" + objIdx);\n        return false;\n    }\n\n    private _getClipRgn() {\n        if (this.state.clip != null) {\n            if (!this.state.ownclip) {\n                this.state.clip = this.state.clip.clone();\n            }\n        } else {\n            if (this.state.selected.region != null) {\n                this.state.clip = this.state.selected.region.clone();\n            } else {\n                this.state.clip = CreateSimpleRegion(this.state.wx, this.state.wy, this.state.wx + this.state.ww,\n                    this.state.wy + this.state.wh);\n            }\n        }\n        this.state.ownclip = true;\n        return this.state.clip;\n    }\n\n    private _todevX(val: number) {\n        // http://wvware.sourceforge.net/caolan/mapmode.html\n        // logical -> device\n        return Math.floor((val - this.state.wx) * (this.state.vw / this.state.ww)) + this.state.vx;\n    }\n\n    private _todevY(val: number) {\n        // http://wvware.sourceforge.net/caolan/mapmode.html\n        // logical -> device\n        return Math.floor((val - this.state.wy) * (this.state.vh / this.state.wh)) + this.state.vy;\n    }\n\n    private _todevW(val: number) {\n        // http://wvware.sourceforge.net/caolan/mapmode.html\n        // logical -> device\n        return Math.floor(val * (this.state.vw / this.state.ww)) + this.state.vx;\n    }\n\n    private _todevH(val: number) {\n        // http://wvware.sourceforge.net/caolan/mapmode.html\n        // logical -> device\n        return Math.floor(val * (this.state.vh / this.state.wh)) + this.state.vy;\n    }\n\n    private _tologicalX(val: number) {\n        // http://wvware.sourceforge.net/caolan/mapmode.html\n        // logical -> device\n        return Math.floor((val - this.state.vx) / (this.state.vw / this.state.ww)) + this.state.wx;\n    }\n\n    private _tologicalY(val: number) {\n        // http://wvware.sourceforge.net/caolan/mapmode.html\n        // logical -> device\n        return Math.floor((val - this.state.vy) / (this.state.vh / this.state.wh)) + this.state.wy;\n    }\n\n    private _tologicalW(val: number) {\n        // http://wvware.sourceforge.net/caolan/mapmode.html\n        // logical -> device\n        return Math.floor(val / (this.state.vw / this.state.ww)) + this.state.wx;\n    }\n\n    private _tologicalH(val: number) {\n        // http://wvware.sourceforge.net/caolan/mapmode.html\n        // logical -> device\n        return Math.floor(val / (this.state.vh / this.state.wh)) + this.state.wy;\n    }\n\n    private _applyOpts(opts: any, usePen: boolean, useBrush: boolean, useFont: boolean) {\n        if (opts == null) {\n            opts = {};\n        }\n        if (usePen) {\n            const pen = this.state.selected.pen;\n            if (pen.style !== Helper.GDI.PenStyle.PS_NULL) {\n                opts.stroke =  \"#\" + pen.color.toHex(), // TODO: pen style\n                    opts.strokeWidth = this._todevW(pen.width.x); // TODO: is .y ever used?\n\n                let dotWidth;\n                if ((pen.linecap & Helper.GDI.PenStyle.PS_ENDCAP_SQUARE) !== 0) {\n                    opts[\"stroke-linecap\"] = \"square\";\n                    dotWidth = 1;\n                } else if ((pen.linecap & Helper.GDI.PenStyle.PS_ENDCAP_FLAT) !== 0) {\n                    opts[\"stroke-linecap\"] = \"butt\";\n                    dotWidth = opts.strokeWidth;\n                } else {\n                    opts[\"stroke-linecap\"] = \"round\";\n                    dotWidth = 1;\n                }\n\n                if ((pen.join & Helper.GDI.PenStyle.PS_JOIN_BEVEL) !== 0) {\n                    opts[\"stroke-linejoin\"] = \"bevel\";\n                } else if ((pen.join & Helper.GDI.PenStyle.PS_JOIN_MITER) !== 0) {\n                    opts[\"stroke-linejoin\"] = \"miter\";\n                } else {\n                    opts[\"stroke-linejoin\"] = \"round\";\n                }\n\n                const dashWidth = opts.strokeWidth * 4;\n                const dotSpacing = opts.strokeWidth * 2;\n                switch (pen.style) {\n                    case Helper.GDI.PenStyle.PS_DASH:\n                        opts[\"stroke-dasharray\"] = [dashWidth, dotSpacing].toString();\n                        break;\n                    case Helper.GDI.PenStyle.PS_DOT:\n                        opts[\"stroke-dasharray\"] = [dotWidth, dotSpacing].toString();\n                        break;\n                    case Helper.GDI.PenStyle.PS_DASHDOT:\n                        opts[\"stroke-dasharray\"] = [dashWidth, dotSpacing, dotWidth, dotSpacing].toString();\n                        break;\n                    case Helper.GDI.PenStyle.PS_DASHDOTDOT:\n                        opts[\"stroke-dasharray\"]\n                            = [dashWidth, dotSpacing, dotWidth, dotSpacing, dotWidth, dotSpacing].toString();\n                        break;\n                }\n            }\n        }\n        if (useBrush) {\n            const brush = this.state.selected.brush;\n            switch (brush.style) {\n                case Helper.GDI.BrushStyle.BS_SOLID:\n                    opts.fill = \"#\" + brush.color.toHex();\n                    break;\n                case Helper.GDI.BrushStyle.BS_PATTERN:\n                case Helper.GDI.BrushStyle.BS_DIBPATTERNPT:\n                    opts.fill = \"url(#\" + this._getSvgPatternForBrush(brush) + \")\";\n                    break;\n                case Helper.GDI.BrushStyle.BS_NULL:\n                    opts.fill = \"none\";\n                    break;\n                default:\n                    Helper.log(\"[gdi] unsupported brush style: \" + brush.style);\n                    opts.fill = \"none\";\n                    break;\n            }\n        }\n        if (useFont) {\n            const font = this.state.selected.font;\n            opts[\"font-family\"] = font.facename;\n            opts[\"font-size\"] = this._todevH(Math.abs(font.height));\n            opts.fill = \"#\" + this.state.textcolor.toHex();\n        }\n        return opts;\n    }\n}\n","/*\n\nThe MIT License (MIT)\n\nCopyright (c) 2015 Thomas Bluemel\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n\n*/\n\nimport { Blob } from \"./Blob\";\nimport { WMFJSError } from \"./Helper\";\n\nexport class PointS {\n    public x: number;\n    public y: number;\n\n    constructor(reader: Blob, x?: number, y?: number) {\n        if (reader != null) {\n            this.x = reader.readInt16();\n            this.y = reader.readInt16();\n        } else {\n            this.x = x;\n            this.y = y;\n        }\n    }\n\n    public clone() {\n        return new PointS(null, this.x, this.y);\n    }\n\n    public toString() {\n        return \"{x: \" + this.x + \", y: \" + this.y + \"}\";\n    }\n}\n\nexport class Rect {\n    public bottom: number;\n    public right: number;\n    public top: number;\n    public left: number;\n\n    constructor(reader: Blob, left?: number, top?: number, right?: number, bottom?: number) {\n        if (reader != null) {\n            this.bottom = reader.readInt16();\n            this.right = reader.readInt16();\n            this.top = reader.readInt16();\n            this.left = reader.readInt16();\n        } else {\n            this.bottom = bottom;\n            this.right = right;\n            this.top = top;\n            this.left = left;\n        }\n    }\n\n    public clone() {\n        return new Rect(null, this.left, this.top, this.right, this.bottom);\n    }\n\n    public toString() {\n        return \"{left: \" + this.left + \", top: \" + this.top + \", right: \" + this.right\n            + \", bottom: \" + this.bottom + \"}\";\n    }\n\n    public empty() {\n        return this.left >= this.right || this.top >= this.bottom;\n    }\n\n    public intersect(rect: Rect) {\n        if (this.empty() || rect.empty()) {\n            return null;\n        }\n        if (this.left >= rect.right || this.top >= rect.bottom ||\n            this.right <= rect.left || this.bottom <= rect.top) {\n            return null;\n        }\n        return new Rect(null, Math.max(this.left, rect.left), Math.max(this.top, rect.top),\n            Math.min(this.right, rect.right), Math.min(this.bottom, rect.bottom));\n    }\n}\n\nexport class Obj {\n    public type: string;\n\n    constructor(type: string) {\n        this.type = type;\n    }\n\n    public clone(): Obj {\n        throw new WMFJSError(\"clone not implemented\");\n    }\n\n    public toString() {\n        throw new WMFJSError(\"toString not implemented\");\n    }\n}\n","/*\n\nThe MIT License (MIT)\n\nCopyright (c) 2015 Thomas Bluemel\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n\n*/\n\nimport { Blob } from \"./Blob\";\nimport { Helper, WMFJSError } from \"./Helper\";\nimport { Obj, Rect } from \"./Primitives\";\n\nexport class Region extends Obj {\n    public bounds: Rect;\n    public scans: Scan[];\n    public complexity: number;\n\n    constructor(reader: Blob, copy?: Region) {\n        super(\"region\");\n        if (reader != null) {\n            reader.skip(2);\n            if (reader.readInt16() !== 6) {\n                throw new WMFJSError(\"Invalid region identifier\");\n            }\n            reader.skip(2);\n            const rgnSize = reader.readInt16();\n            const scanCnt = reader.readInt16();\n            reader.skip(2);\n            // note, Rect in reverse, can't use Rect(reader) directly\n            const left = reader.readInt16();\n            const top = reader.readInt16();\n            const right = reader.readInt16();\n            const bottom = reader.readInt16();\n            this.bounds = new Rect(null, left, top, right, bottom);\n            this.scans = [];\n            for (let i = 0; i < scanCnt; i++) {\n                this.scans.push(new Scan(reader));\n            }\n            this._updateComplexity();\n        } else if (copy != null) {\n            this.bounds = copy.bounds != null ? copy.bounds.clone() : null;\n            if (copy.scans != null) {\n                this.scans = [];\n                for (let i = 0; i < copy.scans.length; i++) {\n                    this.scans.push(copy.scans[i].clone());\n                }\n            } else {\n                this.scans = null;\n            }\n            this.complexity = copy.complexity;\n        } else {\n            this.bounds = null;\n            this.scans = null;\n            this.complexity = 0;\n        }\n    }\n\n    public clone() {\n        return new Region(null, this);\n    }\n\n    public toString() {\n        const _complexity = [\"null\", \"simple\", \"complex\"];\n        return \"{complexity: \" + _complexity[this.complexity]\n            + \" bounds: \" + (this.bounds != null ? this.bounds.toString() : \"[none]\")\n            + \" #scans: \" + (this.scans != null ? this.scans.length : \"[none]\") + \"}\";\n    }\n\n    public _updateComplexity() {\n        if (this.bounds == null) {\n            this.complexity = 0;\n            this.scans = null;\n        } else if (this.bounds.empty()) {\n            this.complexity = 0;\n            this.scans = null;\n            this.bounds = null;\n        } else if (this.scans == null) {\n            this.complexity = 1;\n        } else {\n            this.complexity = 2;\n            if (this.scans.length === 1) {\n                const scan = this.scans[0];\n                if (scan.top === this.bounds.top && scan.bottom === this.bounds.bottom && scan.scanlines.length === 1) {\n                    const scanline = scan.scanlines[0];\n                    if (scanline.left === this.bounds.left && scanline.right === this.bounds.right) {\n                        this.scans = null;\n                        this.complexity = 1;\n                    }\n                }\n            }\n        }\n    }\n\n    public subtract(rect: Rect) {\n        Helper.log(\"[wmf] Region \" + this.toString() + \" subtract \" + rect.toString());\n\n        if (this.bounds != null) {\n            const isect = this.bounds.intersect(rect);\n            if (isect != null) { // Only need to do anything if there is any chance of an overlap\n                if (this.scans == null) {\n                    // We currently have a simple region and there is some kind of an overlap.\n                    // We need to create scanlines now.  Simplest method is to fake one scan line\n                    // that equals the simple region and re-use the same logic as for complex regions\n                    this.scans = [];\n                    this.scans.push( new Scan(null, null, this.bounds.top, this.bounds.bottom,\n                        [{left: this.bounds.left, right: this.bounds.right}]));\n                    this.complexity = 2;\n                }\n\n                // We (now) have a complex region.  First we skip any scans that are entirely above rect.top\n                // The first scan that falls partially below rect.top needs to be split into two scans.\n                let si = 0;\n                while (si < this.scans.length) {\n                    const scan = this.scans[si];\n                    if (scan.bottom >= rect.top) {\n                        // We need to clone this scan into two so that we can subtract from the second one\n                        const cloned = scan.clone();\n                        scan.bottom = rect.top - 1;\n                        cloned.top = rect.top;\n                        if (scan.top >= scan.bottom) {\n                            this.scans[si] = cloned;\n                        } else {\n                            Helper.log(\"[wmf] Region split top scan \" + si + \" for substraction\");\n                            this.scans.splice(++si, 0, cloned);\n                        }\n                        break;\n                    }\n                    si++;\n                }\n\n                // Now find the first one that falls at least partially below rect.bottom, which needs to be\n                // split if it is only partially below rect.bottom\n                const first = si;\n                while (si < this.scans.length) {\n                    const scan = this.scans[si];\n                    if (scan.top > rect.bottom) {\n                        break;\n                    }\n                    if (scan.bottom > rect.bottom) {\n                        // We need to clone this scan into two so that we can subtract from the first one\n                        const cloned = scan.clone();\n                        scan.bottom = rect.bottom;\n                        cloned.top = rect.bottom + 1;\n                        if (scan.top >= scan.bottom) {\n                            this.scans[si] = cloned;\n                        } else {\n                            Helper.log(\"[wmf] Region split bottom scan \" + si + \" for substraction\");\n                            this.scans.splice(++si, 0, cloned);\n                        }\n                        break;\n                    }\n                    si++;\n                }\n\n                // Now perform a subtraction on each scan in between rect.top and rect.bottom.  Because we\n                // cloned scans that partially overlapped rect.top and rect.bottom, we don't have to\n                // account for this anymore.\n                if (first < this.scans.length) {\n                    let last = si;\n                    si = first;\n                    while (si < last) {\n                        const scan = this.scans[si];\n                        if (!scan.subtract(rect.left, rect.right)) {\n                            Helper.log(\"[wmf] Region remove now empty scan \" + si + \" due to subtraction\");\n                            this.scans.splice(si, 1);\n                            last--;\n                            continue;\n                        }\n\n                        si++;\n                    }\n                }\n\n                // Update bounds\n                if (this.scans != null) {\n                    let left;\n                    let top;\n                    let right;\n                    let bottom;\n                    const len = this.scans.length;\n                    for (let i = 0; i < len; i++) {\n                        const scan = this.scans[i];\n                        if (i === 0) {\n                            top = scan.top;\n                        }\n                        if (i === len - 1) {\n                            bottom = scan.bottom;\n                        }\n\n                        const slen = scan.scanlines.length;\n                        if (slen > 0) {\n                            let scanline = scan.scanlines[0];\n                            if (left == null || scanline.left < left) {\n                                left = scanline.left;\n                            }\n                            scanline = scan.scanlines[slen - 1];\n                            if (right == null || scanline.right > right) {\n                                right = scanline.right;\n                            }\n                        }\n                    }\n\n                    if (left != null && top != null && right != null && bottom != null) {\n                        this.bounds = new Rect(null, left, top, right, bottom);\n                        this._updateComplexity();\n                    } else {\n                        // This has to be a null region now\n                        this.bounds = null;\n                        this.scans = null;\n                        this.complexity = 0;\n                    }\n                } else {\n                    this._updateComplexity();\n                }\n            }\n        }\n\n        Helper.log(\"[wmf] Region subtraction -> \" + this.toString());\n    }\n\n    public intersect(rect: Rect) {\n        Helper.log(\"[wmf] Region \" + this.toString() + \" intersect with \" + rect.toString());\n        if (this.bounds != null) {\n            this.bounds = this.bounds.intersect(rect);\n            if (this.bounds != null) {\n                if (this.scans != null) {\n                    let si = 0;\n                    // Remove any scans that are entirely above the new bounds.top\n                    while (si < this.scans.length) {\n                        const scan = this.scans[si];\n                        if (scan.bottom < this.bounds.top) {\n                            si++;\n                        } else {\n                            break;\n                        }\n                    }\n                    if (si > 0) {\n                        Helper.log(\"[wmf] Region remove \" + si + \" scans from top\");\n                        this.scans.splice(0, si);\n\n                        // Adjust the first scan's top to match the new bounds.top\n                        if (this.scans.length > 0) {\n                            this.scans[0].top = this.bounds.top;\n                        }\n                    }\n\n                    // Get rid of anything that falls outside the new bounds.left/bounds.right\n                    si = 0;\n                    while (si < this.scans.length) {\n                        const scan = this.scans[si];\n                        if (scan.top > this.bounds.bottom) {\n                            // Remove this and all remaining scans that fall entirely below the new bounds.bottom\n                            Helper.log(\"[wmf] Region remove \" + (this.scans.length - si) + \" scans from bottom\");\n                            this.scans.splice(si, this.scans.length - si);\n                            break;\n                        }\n                        if (!scan.intersect(this.bounds.left, this.bounds.right)) {\n                            // Remove now empty scan\n                            Helper.log(\"[wmf] Region remove now empty scan \" + si + \" due to intersection\");\n                            this.scans.splice(si, 1);\n                            continue;\n                        }\n                        si++;\n                    }\n\n                    // If there are any scans left, adjust the last one's bottom to the new bounds.bottom\n                    if (this.scans.length > 0) {\n                        this.scans[this.scans.length - 1].bottom = this.bounds.bottom;\n                    }\n\n                    this._updateComplexity();\n                }\n            } else {\n                this.scans = null;\n                this.complexity = 0;\n            }\n        }\n        Helper.log(\"[wmf] Region intersection -> \" + this.toString());\n    }\n\n    public offset(offX: number, offY: number) {\n        if (this.bounds != null) {\n            this.bounds.left += offX;\n            this.bounds.top += offY;\n            this.bounds.right += offX;\n            this.bounds.bottom += offY;\n        }\n\n        if (this.scans != null) {\n            const slen = this.scans.length;\n            for (let si = 0; si < slen; si++) {\n                const scan = this.scans[si];\n                scan.top += offY;\n                scan.bottom += offY;\n\n                const len = scan.scanlines.length;\n                for (let i = 0; i < len; i++) {\n                    const scanline = scan.scanlines[i];\n                    scanline.left += offX;\n                    scanline.right += offX;\n                }\n            }\n        }\n    }\n}\n\nexport function CreateSimpleRegion(left: number, top: number, right: number, bottom: number) {\n    const rgn = new Region(null, null);\n    rgn.bounds = new Rect(null, left, top, right, bottom);\n    rgn._updateComplexity();\n    return rgn;\n}\n\nexport class Scan {\n    public top: number;\n    public bottom: number;\n    public scanlines: Array<{left: number, right: number}>;\n\n    constructor(reader: Blob, copy?: Scan, top?: number, bottom?: number,\n                scanlines?: Array<{left: number, right: number}>) {\n        if (reader != null) {\n            const cnt = reader.readUint16();\n            this.top = reader.readUint16();\n            this.bottom = reader.readUint16();\n            this.scanlines = [];\n            for (let i = 0; i < cnt; i++) {\n                const left = reader.readUint16();\n                const right = reader.readUint16();\n                this.scanlines.push({left, right});\n            }\n            reader.skip(2);\n        } else if (copy != null) {\n            this.top = copy.top;\n            this.bottom = copy.bottom;\n            this.scanlines = [];\n            for (let i = 0; i < copy.scanlines.length; i++) {\n                const scanline = copy.scanlines[i];\n                this.scanlines.push({left: scanline.left, right: scanline.right});\n            }\n        } else {\n            this.top = top;\n            this.bottom = bottom;\n            this.scanlines = scanlines;\n        }\n    }\n\n    public clone() {\n        return new Scan(null, this);\n    }\n\n    public subtract(left: number, right: number) {\n        let i;\n\n        // Keep everything on the left side\n        i = 0;\n        while (i < this.scanlines.length) {\n            const scanline = this.scanlines[i];\n            if (scanline.left <= left) {\n                if (scanline.right >= left) {\n                    scanline.right = left - 1;\n                    if (scanline.left >= scanline.right) {\n                        this.scanlines.splice(i, 1);\n                        continue;\n                    }\n                }\n                i++;\n            } else {\n                break;\n            }\n        }\n\n        // Find the first one that may exceed to the right side\n        const first = i;\n        let cnt = 0;\n        while (i < this.scanlines.length) {\n            const scanline = this.scanlines[i];\n            if (scanline.right > right) {\n                scanline.left = right;\n                cnt = i - first;\n                if (scanline.left >= scanline.right) {\n                    cnt++;\n                }\n                break;\n            }\n            i++;\n        }\n\n        // Delete everything we're subtracting\n        if (cnt > 0 && first < this.scanlines.length) {\n            this.scanlines.splice(first, cnt);\n        }\n\n        return this.scanlines.length > 0;\n    }\n\n    public intersect(left: number, right: number) {\n        // Get rid of anything that falls entirely outside to the left\n        for (let i = 0; i < this.scanlines.length; i++) {\n            const scanline = this.scanlines[i];\n            if (scanline.left >= left || scanline.right >= left) {\n                if (i > 0) {\n                    this.scanlines.splice(0, i);\n                }\n                break;\n            }\n        }\n\n        if (this.scanlines.length > 0) {\n            // Adjust the first to match the left, if needed\n            let scanline = this.scanlines[0];\n            if (scanline.left < left) {\n                scanline.left = left;\n            }\n\n            // Get rid of anything that falls entirely outside to the right\n            for (let i = 0; i < this.scanlines.length; i++) {\n                scanline = this.scanlines[i];\n                if (scanline.left > right) {\n                    this.scanlines.splice(i, this.scanlines.length - i);\n                    break;\n                }\n            }\n\n            if (this.scanlines.length > 0) {\n                // Adjust the last to match the right, if needed\n                scanline = this.scanlines[this.scanlines.length - 1];\n                if (scanline.right > right) {\n                    scanline.right = right;\n                }\n            }\n        }\n        return this.scanlines.length > 0;\n    }\n\n    public toString() {\n        return \"{ #scanlines: \" + this.scanlines.length + \"}\";\n    }\n}\n","/*\n\nThe MIT License (MIT)\n\nCopyright (c) 2015 Thomas Bluemel\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n\n*/\n\nimport { Bitmap16, DIBitmap, PatternBitmap16 } from \"./Bitmap\";\nimport { Blob } from \"./Blob\";\nimport { Helper } from \"./Helper\";\nimport { Obj, PointS } from \"./Primitives\";\n\nexport class ColorRef {\n    public r: number;\n    public g: number;\n    public b: number;\n\n    constructor(reader: Blob, r?: number, g?: number, b?: number) {\n        if (reader != null) {\n            this.r = reader.readUint8();\n            this.g = reader.readUint8();\n            this.b = reader.readUint8();\n            reader.skip(1);\n        } else {\n            this.r = r;\n            this.g = g;\n            this.b = b;\n        }\n    }\n\n    public clone() {\n        return new ColorRef(null, this.r, this.g, this.b);\n    }\n\n    public toHex() {\n        const rgb = (this.r << 16) | (this.g << 8) | this.b;\n        return (0x1000000 + rgb).toString(16).slice(1);\n    }\n\n    public toString() {\n        return \"{r: \" + this.r + \", g: \" + this.g + \", b: \" + this.b + \"}\";\n    }\n}\n\nexport class Font extends Obj {\n    public height: number;\n    public width: number;\n    public escapement: number;\n    public orientation: number;\n    public weight: number;\n    public italic: number;\n    public underline: number;\n    public strikeout: number;\n    public charset: number;\n    public outprecision: number;\n    public clipprecision: number;\n    public quality: number;\n    public pitch: number;\n    public family: number;\n    public facename: string;\n\n    constructor(reader: Blob, copy: Font | number) {\n        super(\"font\");\n        if (reader != null) {\n            this.height = reader.readInt16();\n            this.width = reader.readInt16();\n            this.escapement = reader.readInt16();\n            this.orientation = reader.readInt16();\n            this.weight = reader.readInt16();\n            this.italic = reader.readUint8();\n            this.underline = reader.readUint8();\n            this.strikeout = reader.readUint8();\n            this.charset = reader.readUint8();\n            this.outprecision = reader.readUint8();\n            this.clipprecision = reader.readUint8();\n            this.quality = reader.readUint8();\n            const pitchAndFamily = reader.readUint8();\n            this.pitch = pitchAndFamily & 0xf; // TODO: double check\n            this.family = (pitchAndFamily >> 6) & 0x3; // TODO: double check\n\n            const dataLength = copy as number;\n            const start = reader.pos;\n            this.facename = reader.readNullTermString(Math.min(dataLength - (reader.pos - start), 32));\n        } else if (copy != null) {\n            copy = copy as Font;\n            this.height = copy.height;\n            this.width = copy.width;\n            this.escapement = copy.escapement;\n            this.orientation = copy.orientation;\n            this.weight = copy.weight;\n            this.italic = copy.italic;\n            this.underline = copy.underline;\n            this.strikeout = copy.strikeout;\n            this.charset = copy.charset;\n            this.outprecision = copy.outprecision;\n            this.clipprecision = copy.clipprecision;\n            this.quality = copy.quality;\n            this.pitch = copy.pitch;\n            this.family = copy.family;\n            this.facename = copy.facename;\n        } else {\n            // TODO: Values for a default font?\n            this.height = -80;\n            this.width = 0;\n            this.escapement = 0;\n            this.orientation = 0;\n            this.weight = 400;\n            this.italic = 0;\n            this.underline = 0;\n            this.strikeout = 0;\n            this.charset = 0;\n            this.outprecision = 0;\n            this.clipprecision = 0;\n            this.quality = 0;\n            this.pitch = 0;\n            this.family = 0;\n            this.facename = \"Helvetica\";\n        }\n    }\n\n    public clone() {\n        return new Font(null, this);\n    }\n\n    public toString() {\n        return JSON.stringify(this);\n    }\n}\n\nexport class Brush extends Obj {\n    public style: number;\n    public color: ColorRef;\n    public pattern: Bitmap16;\n    public colorusage: number;\n    public dibpatternpt: DIBitmap;\n    public hatchstyle: number;\n\n    constructor(reader: Blob, copy: Brush | number, forceDibPattern?: boolean | PatternBitmap16) {\n        super(\"brush\");\n        if (reader != null) {\n            const dataLength = copy as number;\n            const start = reader.pos;\n\n            if (forceDibPattern === true || forceDibPattern === false) {\n                this.style = reader.readUint16();\n                if (forceDibPattern && this.style !== Helper.GDI.BrushStyle.BS_PATTERN) {\n                    this.style = Helper.GDI.BrushStyle.BS_DIBPATTERNPT;\n                }\n                switch (this.style) {\n                    case Helper.GDI.BrushStyle.BS_SOLID:\n                        this.color = new ColorRef(reader);\n                        break;\n                    case Helper.GDI.BrushStyle.BS_PATTERN:\n                        reader.skip(forceDibPattern ? 2 : 6);\n                        this.pattern = new Bitmap16(reader, dataLength - (reader.pos - start));\n                        break;\n                    case Helper.GDI.BrushStyle.BS_DIBPATTERNPT:\n                        this.colorusage = forceDibPattern ? reader.readUint16() : reader.readUint32();\n                        if (!forceDibPattern) {\n                            reader.skip(2);\n                        }\n                        this.dibpatternpt = new DIBitmap(reader, dataLength - (reader.pos - start));\n                        break;\n                    case Helper.GDI.BrushStyle.BS_HATCHED:\n                        this.color = new ColorRef(reader);\n                        this.hatchstyle = reader.readUint16();\n                        break;\n                }\n            } else if (forceDibPattern instanceof PatternBitmap16) {\n                this.style = Helper.GDI.BrushStyle.BS_PATTERN;\n                this.pattern = forceDibPattern;\n            }\n        } else if (copy != null) {\n            copy = copy as Brush;\n            this.style = copy.style;\n            switch (this.style) {\n                case Helper.GDI.BrushStyle.BS_SOLID:\n                    this.color = copy.color.clone();\n                    break;\n                case Helper.GDI.BrushStyle.BS_PATTERN:\n                    this.pattern = copy.pattern.clone();\n                    break;\n                case Helper.GDI.BrushStyle.BS_DIBPATTERNPT:\n                    this.colorusage = copy.colorusage;\n                    this.dibpatternpt = copy.dibpatternpt;\n                    break;\n                case Helper.GDI.BrushStyle.BS_HATCHED:\n                    this.color = copy.color.clone();\n                    this.hatchstyle = copy.hatchstyle;\n                    break;\n            }\n        }\n    }\n\n    public clone() {\n        return new Brush(null, this);\n    }\n\n    public toString() {\n        let ret = \"{style: \" + this.style;\n        switch (this.style) {\n            case Helper.GDI.BrushStyle.BS_SOLID:\n                ret += \", color: \" + this.color.toString();\n                break;\n            case Helper.GDI.BrushStyle.BS_DIBPATTERNPT:\n                ret += \", colorusage: \" + this.colorusage;\n                break;\n            case Helper.GDI.BrushStyle.BS_HATCHED:\n                ret += \", color: \" + this.color.toString() + \", hatchstyle: \" + this.hatchstyle;\n                break;\n        }\n        return ret + \"}\";\n    }\n}\n\nexport class Pen extends Obj {\n    public style: number;\n    public width: PointS;\n    public color: ColorRef;\n    public linecap: number;\n    public join: number;\n\n    constructor(reader: Blob, style?: number, width?: PointS, color?: ColorRef, linecap?: number, join?: number) {\n        super(\"pen\");\n        if (reader != null) {\n            style = reader.readUint16();\n            this.style = style & 0xFF;\n            this.width = new PointS(reader);\n            this.color = new ColorRef(reader);\n            this.linecap = (style & (Helper.GDI.PenStyle.PS_ENDCAP_SQUARE | Helper.GDI.PenStyle.PS_ENDCAP_FLAT));\n            this.join = (style & (Helper.GDI.PenStyle.PS_JOIN_BEVEL | Helper.GDI.PenStyle.PS_JOIN_MITER));\n        } else {\n            this.style = style;\n            this.width = width;\n            this.color = color;\n            this.linecap = linecap;\n            this.join = join;\n        }\n    }\n\n    public clone() {\n        return new Pen(null, this.style, this.width.clone(), this.color.clone(), this.linecap, this.join);\n    }\n\n    public toString() {\n        return \"{style: \" + this.style + \", width: \" + this.width.toString() + \", color: \" + this.color.toString()\n            + \", linecap: \" + this.linecap + \", join: \" + this.join + \"}\";\n    }\n}\n\nexport class PaletteEntry {\n    public flag: number;\n    public b: number;\n    public g: number;\n    public r: number;\n\n    constructor(reader: Blob, copy?: PaletteEntry) {\n        if (reader != null) {\n            this.flag = reader.readUint8();\n            this.b = reader.readUint8();\n            this.g = reader.readUint8();\n            this.r = reader.readUint8();\n        } else {\n            this.flag = copy.flag;\n            this.b = copy.b;\n            this.g = copy.g;\n            this.r = copy.r;\n        }\n    }\n\n    public clone() {\n        return new PaletteEntry(null, this);\n    }\n}\n\nexport class Palette extends Obj {\n    public start: number;\n    public entries: PaletteEntry[];\n\n    constructor(reader: Blob, copy?: Palette) {\n        super(\"palette\");\n        if (reader != null) {\n            this.start = reader.readUint16();\n            const cnt = reader.readUint16();\n            this.entries = [];\n            while (cnt > 0) {\n                this.entries.push(new PaletteEntry(reader));\n            }\n        } else {\n            this.start = copy.start;\n            this.entries = [];\n            const len = copy.entries.length;\n            for (let i = 0; i < len; i++) {\n                this.entries.push(copy.entries[i]);\n            }\n        }\n    }\n\n    public clone() {\n        return new Palette(null, this);\n    }\n\n    public toString() {\n        return \"{ #entries: \" + this.entries.length + \"}\"; // TODO\n    }\n}\n","/*\n\nThe MIT License (MIT)\n\nCopyright (c) 2015 Thomas Bluemel\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n\n*/\n\nimport { Blob } from \"./Blob\";\nimport { Helper, WMFJSError } from \"./Helper\";\n\nexport class BitmapBase {\n    public getWidth() {\n        throw new WMFJSError(\"getWidth not implemented\");\n    }\n\n    public getHeight() {\n        throw new WMFJSError(\"getHeight not implemented\");\n    }\n}\n\nexport class BitmapCoreHeader {\n    public width: number;\n    public height: number;\n    public planes: number;\n    public bitcount: number;\n\n    constructor(reader: Blob, skipsize: boolean) {\n        if (skipsize) {\n            reader.skip(4);\n        }\n        this.width = reader.readUint16();\n        this.height = reader.readUint16();\n        this.planes = reader.readUint16();\n        this.bitcount = reader.readUint16();\n    }\n\n    public colors() {\n        return this.bitcount <= 8 ? 1 << this.bitcount : 0;\n    }\n}\n\nexport class BitmapInfoHeader {\n    public width: number;\n    public height: number;\n    public planes: number;\n    public bitcount: number;\n    public compression: number;\n    public sizeimage: number;\n    public xpelspermeter: number;\n    public ypelspermeter: number;\n    public clrused: number;\n    public clrimportant: number;\n\n    constructor(reader: Blob, skipsize: boolean) {\n        if (skipsize) {\n            reader.skip(4);\n        }\n        this.width = reader.readInt32();\n        this.height = reader.readInt32();\n        this.planes = reader.readUint16();\n        this.bitcount = reader.readUint16();\n        this.compression = reader.readUint32();\n        this.sizeimage = reader.readUint32();\n        this.xpelspermeter = reader.readInt32();\n        this.ypelspermeter = reader.readInt32();\n        this.clrused = reader.readUint32();\n        this.clrimportant = reader.readUint32();\n    }\n\n    public colors() {\n        if (this.clrused !== 0) {\n            return this.clrused < 256 ? this.clrused : 256;\n        } else {\n            return this.bitcount > 8 ? 0 : 1 << this.bitcount;\n        }\n    }\n}\n\nexport class BitmapInfo extends BitmapBase {\n    private _reader: Blob;\n    private _offset: number;\n    private _usergb: boolean;\n    private _infosize: number;\n    private _header: BitmapCoreHeader | BitmapInfoHeader;\n\n    constructor(reader: Blob, usergb: boolean) {\n        super();\n        this._reader = reader;\n        this._offset = reader.pos;\n        this._usergb = usergb;\n        const hdrsize = reader.readUint32();\n        this._infosize = hdrsize;\n        if (hdrsize === Helper.GDI.BITMAPCOREHEADER_SIZE) {\n            this._header = new BitmapCoreHeader(reader, false);\n            this._infosize += this._header.colors() * (usergb ? 3 : 2);\n        } else {\n            this._header = new BitmapInfoHeader(reader, false);\n            const masks =\n                (this._header as BitmapInfoHeader).compression === Helper.GDI.BitmapCompression.BI_BITFIELDS ? 3 : 0;\n            if (hdrsize <= Helper.GDI.BITMAPINFOHEADER_SIZE + (masks * 4)) {\n                this._infosize = Helper.GDI.BITMAPINFOHEADER_SIZE + (masks * 4);\n            }\n            this._infosize += this._header.colors() * (usergb ? 4 : 2);\n        }\n    }\n\n    public getWidth() {\n        return this._header.width;\n    }\n\n    public getHeight() {\n        return Math.abs(this._header.height);\n    }\n\n    public infosize() {\n        return this._infosize;\n    }\n\n    public header() {\n        return this._header;\n    }\n}\n\nexport class DIBitmap extends BitmapBase {\n    private _reader: Blob;\n    private _offset: number;\n    private _size: number;\n    private _info: BitmapInfo;\n\n    constructor(reader: Blob, size: number) {\n        super();\n        this._reader = reader;\n        this._offset = reader.pos;\n        this._size = size;\n        this._info = new BitmapInfo(reader, true);\n    }\n\n    public getWidth() {\n        return this._info.getWidth();\n    }\n\n    public getHeight() {\n        return this._info.getHeight();\n    }\n\n    public base64ref() {\n        const prevpos = this._reader.pos;\n        this._reader.seek(this._offset);\n        let mime = \"image/bmp\";\n        const header = this._info.header();\n        let data;\n        if (header instanceof  BitmapInfoHeader && header.compression != null) {\n            switch (header.compression) {\n                case Helper.GDI.BitmapCompression.BI_JPEG:\n                    mime = \"data:image/jpeg\";\n                    break;\n                case Helper.GDI.BitmapCompression.BI_PNG:\n                    mime = \"data:image/png\";\n                    break;\n                default:\n                    data = this.makeBitmapFileHeader();\n                    break;\n            }\n        } else {\n            data = this.makeBitmapFileHeader();\n        }\n\n        if (data != null) {\n            data += this._reader.readBinary(this._size);\n        } else {\n            data = this._reader.readBinary(this._size);\n        }\n\n        const ref = \"data:\" + mime + \";base64,\" + btoa(data);\n        this._reader.seek(prevpos);\n        return ref;\n    }\n\n    private makeBitmapFileHeader() {\n        const buf = new ArrayBuffer(14);\n        const view = new Uint8Array(buf);\n        view[0] = 0x42;\n        view[1] = 0x4d;\n        Helper._writeUint32Val(view, 2, this._size + 14);\n        Helper._writeUint32Val(view, 10, this._info.infosize() + 14);\n        return Helper._blobToBinary(view);\n    }\n}\n\nexport class Bitmap16 extends BitmapBase {\n    public type: number;\n    public width: number;\n    public height: number;\n    public widthBytes: number;\n    public planes: number;\n    public bitsPixel: number;\n    public bitsOffset: number;\n    public bitsSize: number;\n    private _reader: Blob;\n    private _offset: number;\n    private _size: number;\n\n    constructor(reader: Blob, size: number | Bitmap16) {\n        super();\n        if (reader != null) {\n            size = size as number;\n            this._reader = reader;\n            this._offset = reader.pos;\n            this._size = size;\n            this.type = reader.readInt16();\n            this.width = reader.readInt16();\n            this.height = reader.readInt16();\n            this.widthBytes = reader.readInt16();\n            this.planes = reader.readUint8();\n            this.bitsPixel = reader.readUint8();\n            this.bitsOffset = reader.pos;\n            this.bitsSize = (((this.width * this.bitsPixel + 15) >> 4) << 1) * this.height;\n            if (this.bitsSize > size - 10) {\n                throw new WMFJSError(\"Bitmap should have \" + this.bitsSize + \" bytes, but has \" + (size - 10));\n            }\n        } else {\n            const copy = size as Bitmap16;\n            this._reader = copy._reader;\n            this._offset = copy._offset;\n            this._size = copy._size;\n            this.type = copy.type;\n            this.width = copy.width;\n            this.height = copy.height;\n            this.widthBytes = copy.widthBytes;\n            this.planes = copy.planes;\n            this.bitsPixel = copy.bitsPixel;\n            this.bitsOffset = copy.bitsOffset;\n            this.bitsSize = copy.bitsSize;\n        }\n    }\n\n    public getWidth() {\n        return this.width;\n    }\n\n    public getHeight() {\n        return this.height;\n    }\n\n    public clone() {\n        return new Bitmap16(null, this);\n    }\n}\n\nexport class PatternBitmap16 extends Bitmap16 {\n    constructor(reader: Blob, size: number | Bitmap16) {\n        super(reader, size);\n        if (reader != null) {\n            this.bitsOffset += 22; // skip bits (4 bytes) + reserved (18 bytes)\n        }\n    }\n\n    public clone(): PatternBitmap16 {\n        return new PatternBitmap16(null, this);\n    }\n}\n","/*\n\nThe MIT License (MIT)\n\nCopyright (c) 2015 Thomas Bluemel\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n\n*/\n\nimport { DIBitmap, PatternBitmap16 } from \"./Bitmap\";\nimport { Blob } from \"./Blob\";\nimport { GDIContext } from \"./GDIContext\";\nimport { Helper, WMFJSError } from \"./Helper\";\nimport { PointS, Rect } from \"./Primitives\";\nimport { Region } from \"./Region\";\nimport { Brush, ColorRef, Font, Palette, Pen } from \"./Style\";\n\nexport class WMFRecords {\n    private _records: Array<(gdi: GDIContext) => void>;\n\n    constructor(reader: Blob, first: number) {\n        this._records = [];\n\n        let all = false;\n        let curpos = first;\n        main_loop: while (!all) {\n            reader.seek(curpos);\n            const size = reader.readUint32();\n            if (size < 3) {\n                throw new WMFJSError(\"Invalid record size\");\n            }\n            const type = reader.readUint16();\n            switch (type) {\n                case Helper.GDI.RecordType.META_EOF:\n                    all = true;\n                    break main_loop;\n                case Helper.GDI.RecordType.META_SETMAPMODE: {\n                    const mapMode = reader.readUint16();\n                    this._records.push((gdi) => {\n                        gdi.setMapMode(mapMode);\n                    });\n                    break;\n                }\n                case Helper.GDI.RecordType.META_SETWINDOWORG: {\n                    const y = reader.readInt16();\n                    const x = reader.readInt16();\n                    this._records.push((gdi) => {\n                        gdi.setWindowOrg(x, y);\n                    });\n                    break;\n                }\n                case Helper.GDI.RecordType.META_SETWINDOWEXT: {\n                    const y = reader.readInt16();\n                    const x = reader.readInt16();\n                    this._records.push((gdi) => {\n                        gdi.setWindowExt(x, y);\n                    });\n                    break;\n                }\n                case Helper.GDI.RecordType.META_OFFSETWINDOWORG: {\n                    const offY = reader.readInt16();\n                    const offX = reader.readInt16();\n                    this._records.push((gdi) => {\n                        gdi.offsetWindowOrg(offX, offY);\n                    });\n                    break;\n                }\n                case Helper.GDI.RecordType.META_SETVIEWPORTORG: {\n                    const y = reader.readInt16();\n                    const x = reader.readInt16();\n                    this._records.push((gdi) => {\n                        gdi.setViewportOrg(x, y);\n                    });\n                    break;\n                }\n                case Helper.GDI.RecordType.META_SETVIEWPORTEXT: {\n                    const y = reader.readInt16();\n                    const x = reader.readInt16();\n                    this._records.push((gdi) => {\n                        gdi.setViewportExt(x, y);\n                    });\n                    break;\n                }\n                case Helper.GDI.RecordType.META_OFFSETVIEWPORTORG: {\n                    const offY = reader.readInt16();\n                    const offX = reader.readInt16();\n                    this._records.push((gdi) => {\n                        gdi.offsetViewportOrg(offX, offY);\n                    });\n                    break;\n                }\n                case Helper.GDI.RecordType.META_SAVEDC: {\n                    this._records.push((gdi) => {\n                        gdi.saveDC();\n                    });\n                    break;\n                }\n                case Helper.GDI.RecordType.META_RESTOREDC: {\n                    const saved = reader.readInt16();\n                    this._records.push((gdi) => {\n                        gdi.restoreDC(saved);\n                    });\n                    break;\n                }\n                case Helper.GDI.RecordType.META_SETSTRETCHBLTMODE: {\n                    const stretchMode = reader.readUint16();\n                    this._records.push((gdi) => {\n                        gdi.setStretchBltMode(stretchMode);\n                    });\n                    break;\n                }\n                case Helper.GDI.RecordType.META_DIBSTRETCHBLT: {\n                    const haveSrcDib = ((type >> 8) + 3 !== size);\n                    const rasterOp = reader.readUint16() | (reader.readUint16() << 16);\n                    const srcH = reader.readInt16();\n                    const srcW = reader.readInt16();\n                    const srcY = reader.readInt16();\n                    const srcX = reader.readInt16();\n                    const destH = reader.readInt16();\n                    const destW = reader.readInt16();\n                    const destY = reader.readInt16();\n                    const destX = reader.readInt16();\n                    const datalength = size * 2 - (reader.pos - curpos);\n                    const dib = new DIBitmap(reader, datalength);\n                    this._records.push((gdi) => {\n                        gdi.stretchDibBits(srcX, srcY, srcW, srcH, destX, destY, destW, destH, rasterOp, dib);\n                    });\n                    break;\n                }\n                case Helper.GDI.RecordType.META_STRETCHDIB: {\n                    const rasterOp = reader.readUint16() | (reader.readUint16() << 16);\n                    const colorUsage = reader.readInt16();\n                    const srcH = reader.readInt16();\n                    const srcW = reader.readInt16();\n                    const srcY = reader.readInt16();\n                    const srcX = reader.readInt16();\n                    const destH = reader.readInt16();\n                    const destW = reader.readInt16();\n                    const destY = reader.readInt16();\n                    const destX = reader.readInt16();\n                    const datalength = size * 2 - (reader.pos - curpos);\n                    const dib = new DIBitmap(reader, datalength);\n                    this._records.push((gdi) => {\n                        gdi.stretchDib(srcX, srcY, srcW, srcH, destX, destY, destW, destH, rasterOp, colorUsage, dib);\n                    });\n                    break;\n                }\n                case Helper.GDI.RecordType.META_ESCAPE: {\n                    const func = reader.readUint16();\n                    const count = reader.readUint16();\n                    const offset = reader.pos;\n                    const blob = new Blob(reader, offset);\n                    this._records.push((gdi) => {\n                        gdi.escape(func, blob, offset, count);\n                    });\n                    break;\n                }\n                case Helper.GDI.RecordType.META_SETTEXTALIGN: {\n                    const textAlign = reader.readUint16();\n                    this._records.push((gdi) => {\n                        gdi.setTextAlign(textAlign);\n                    });\n                    break;\n                }\n                case Helper.GDI.RecordType.META_SETBKMODE: {\n                    const bkMode = reader.readUint16();\n                    this._records.push((gdi) => {\n                        gdi.setBkMode(bkMode);\n                    });\n                    break;\n                }\n                case Helper.GDI.RecordType.META_SETTEXTCOLOR: {\n                    const textColor = new ColorRef(reader);\n                    this._records.push((gdi) => {\n                        gdi.setTextColor(textColor);\n                    });\n                    break;\n                }\n                case Helper.GDI.RecordType.META_SETBKCOLOR: {\n                    const bkColor = new ColorRef(reader);\n                    this._records.push((gdi) => {\n                        gdi.setBkColor(bkColor);\n                    });\n                    break;\n                }\n                case Helper.GDI.RecordType.META_CREATEBRUSHINDIRECT: {\n                    const datalength = size * 2 - (reader.pos - curpos);\n                    const brush = new Brush(reader, datalength, false);\n                    this._records.push((gdi) => {\n                        gdi.createBrush(brush);\n                    });\n                    break;\n                }\n                case Helper.GDI.RecordType.META_DIBCREATEPATTERNBRUSH: {\n                    const datalength = size * 2 - (reader.pos - curpos);\n                    const brush = new Brush(reader, datalength, true);\n                    this._records.push((gdi) => {\n                        gdi.createBrush(brush);\n                    });\n                    break;\n                }\n                case Helper.GDI.RecordType.META_CREATEPENINDIRECT: {\n                    const pen = new Pen(reader);\n                    this._records.push((gdi) => {\n                        gdi.createPen(pen);\n                    });\n                    break;\n                }\n                case Helper.GDI.RecordType.META_CREATEFONTINDIRECT: {\n                    const datalength = size * 2 - (reader.pos - curpos);\n                    const font = new Font(reader, datalength);\n                    this._records.push((gdi) => {\n                        gdi.createFont(font);\n                    });\n                    break;\n                }\n                case Helper.GDI.RecordType.META_SELECTOBJECT: {\n                    const idx = reader.readUint16();\n                    this._records.push((gdi) => {\n                        gdi.selectObject(idx, null);\n                    });\n                    break;\n                }\n                case Helper.GDI.RecordType.META_SELECTPALETTE: {\n                    const idx = reader.readUint16();\n                    this._records.push((gdi) => {\n                        gdi.selectObject(idx, \"palette\");\n                    });\n                    break;\n                }\n                case Helper.GDI.RecordType.META_SELECTCLIPREGION: {\n                    const idx = reader.readUint16();\n                    this._records.push((gdi) => {\n                        gdi.selectObject(idx, \"region\");\n                    });\n                    break;\n                }\n                case Helper.GDI.RecordType.META_DELETEOBJECT: {\n                    const idx = reader.readUint16();\n                    this._records.push((gdi) => {\n                        gdi.deleteObject(idx);\n                    });\n                    break;\n                }\n                case Helper.GDI.RecordType.META_RECTANGLE: {\n                    const rect = new Rect(reader);\n                    this._records.push((gdi) => {\n                        gdi.rectangle(rect, 0, 0);\n                    });\n                    break;\n                }\n                case Helper.GDI.RecordType.META_ROUNDRECT: {\n                    const rh = reader.readInt16();\n                    const rw = reader.readInt16();\n                    const rect = new Rect(reader);\n                    this._records.push((gdi) => {\n                        gdi.rectangle(rect, rw, rh);\n                    });\n                    break;\n                }\n                case Helper.GDI.RecordType.META_LINETO: {\n                    const y = reader.readInt16();\n                    const x = reader.readInt16();\n                    this._records.push((gdi) => {\n                        gdi.lineTo(x, y);\n                    });\n                    break;\n                }\n                case Helper.GDI.RecordType.META_MOVETO: {\n                    const y = reader.readInt16();\n                    const x = reader.readInt16();\n                    this._records.push((gdi) => {\n                        gdi.moveTo(x, y);\n                    });\n                    break;\n                }\n                case Helper.GDI.RecordType.META_TEXTOUT: {\n                    const len = reader.readInt16();\n                    if (len > 0) {\n                        const text = reader.readString(len);\n                        reader.skip(len % 2);\n                        const y = reader.readInt16();\n                        const x = reader.readInt16();\n                        this._records.push((gdi) => {\n                            gdi.textOut(x, y, text);\n                        });\n                    }\n                    break;\n                }\n                case Helper.GDI.RecordType.META_EXTTEXTOUT: {\n                    const y = reader.readInt16();\n                    const x = reader.readInt16();\n                    const len = reader.readInt16();\n                    const fwOpts = reader.readUint16();\n\n                    let hasRect = null;\n                    let hasDx = null;\n                    if (size * 2 === 14 + len + len % 2) {\n                        hasRect = false;\n                        hasDx = false;\n                    }\n                    if (size * 2 === 14 + 8 + len + len % 2) {\n                        hasRect = true;\n                        hasDx = false;\n                    }\n                    if (size * 2 === 14 + len + len % 2 + len * 2) {\n                        hasRect = false;\n                        hasDx = true;\n                    }\n                    if (size * 2 === 14 + 8 + len + len % 2 + len * 2) {\n                        hasRect = true;\n                        hasDx = true;\n                    }\n\n                    const rect = hasRect ? new Rect(reader) : null;\n                    if (len > 0) {\n                        const text = reader.readString(len);\n                        reader.skip(len % 2);\n\n                        const dx: number[] = [];\n                        if (hasDx) {\n                            for (let i = 0; i < text.length; i++) {\n                                dx.push(reader.readInt16());\n                            }\n                        }\n\n                        this._records.push((gdi) => {\n                            gdi.extTextOut(x, y, text, fwOpts, rect, dx);\n                        });\n                    }\n                    break;\n                }\n                case Helper.GDI.RecordType.META_EXCLUDECLIPRECT: {\n                    const rect = new Rect(reader);\n                    this._records.push((gdi) => {\n                        gdi.excludeClipRect(rect);\n                    });\n                    break;\n                }\n                case Helper.GDI.RecordType.META_INTERSECTCLIPRECT: {\n                    const rect = new Rect(reader);\n                    this._records.push((gdi) => {\n                        gdi.intersectClipRect(rect);\n                    });\n                    break;\n                }\n                case Helper.GDI.RecordType.META_POLYGON: {\n                    let cnt = reader.readInt16();\n                    const points: PointS[] = [];\n                    while (cnt > 0) {\n                        points.push(new PointS(reader));\n                        cnt--;\n                    }\n                    this._records.push((gdi) => {\n                        gdi.polygon(points, true);\n                    });\n                    break;\n                }\n                case Helper.GDI.RecordType.META_SETPOLYFILLMODE: {\n                    const polyfillmode = reader.readUint16();\n                    this._records.push((gdi) => {\n                        gdi.setPolyFillMode(polyfillmode);\n                    });\n                    break;\n                }\n                case Helper.GDI.RecordType.META_POLYPOLYGON: {\n                    const cnt = reader.readUint16();\n                    const polygonsPtCnts = [];\n                    for (let i = 0; i < cnt; i++) {\n                        polygonsPtCnts.push(reader.readUint16());\n                    }\n\n                    const polygons: PointS[][] = [];\n                    for (let i = 0; i < cnt; i++) {\n                        const ptCnt = polygonsPtCnts[i];\n\n                        const p = [];\n                        for (let ip = 0; ip < ptCnt; ip++) {\n                            p.push(new PointS(reader));\n                        }\n                        polygons.push(p);\n                    }\n                    this._records.push((gdi) => {\n                        gdi.polyPolygon(polygons);\n                    });\n                    break;\n                }\n                case Helper.GDI.RecordType.META_POLYLINE: {\n                    let cnt = reader.readInt16();\n                    const points: PointS[] = [];\n                    while (cnt > 0) {\n                        points.push(new PointS(reader));\n                        cnt--;\n                    }\n                    this._records.push((gdi) => {\n                        gdi.polyline(points);\n                    });\n                    break;\n                }\n                case Helper.GDI.RecordType.META_ELLIPSE: {\n                    const rect = new Rect(reader);\n                    this._records.push((gdi) => {\n                        gdi.ellipse(rect);\n                    });\n                    break;\n                }\n                case Helper.GDI.RecordType.META_CREATEPALETTE: {\n                    const palette = new Palette(reader);\n                    this._records.push((gdi) => {\n                        gdi.createPalette(palette);\n                    });\n                    break;\n                }\n                case Helper.GDI.RecordType.META_CREATEREGION: {\n                    const region = new Region(reader);\n                    this._records.push((gdi) => {\n                        gdi.createRegion(region);\n                    });\n                    break;\n                }\n                case Helper.GDI.RecordType.META_CREATEPATTERNBRUSH: {\n                    const datalength = size * 2 - (reader.pos - curpos);\n                    const patternBitmap = new PatternBitmap16(reader, datalength);\n                    const brush = new Brush(reader, datalength, patternBitmap);\n                    this._records.push((gdi) => {\n                        gdi.createPatternBrush(brush);\n                    });\n                    break;\n                }\n                case Helper.GDI.RecordType.META_OFFSETCLIPRGN: {\n                    const offY = reader.readInt16();\n                    const offX = reader.readInt16();\n                    this._records.push((gdi) => {\n                        gdi.offsetClipRgn(offX, offY);\n                    });\n                    break;\n                }\n                case Helper.GDI.RecordType.META_REALIZEPALETTE:\n                case Helper.GDI.RecordType.META_SETPALENTRIES:\n                case Helper.GDI.RecordType.META_SETROP2:\n                case Helper.GDI.RecordType.META_SETRELABS:\n                case Helper.GDI.RecordType.META_SETTEXTCHAREXTRA:\n                case Helper.GDI.RecordType.META_RESIZEPALETTE:\n                case Helper.GDI.RecordType.META_SETLAYOUT:\n                case Helper.GDI.RecordType.META_FILLREGION:\n                case Helper.GDI.RecordType.META_SETMAPPERFLAGS:\n                case Helper.GDI.RecordType.META_SETTEXTJUSTIFICATION:\n                case Helper.GDI.RecordType.META_SCALEWINDOWEXT:\n                case Helper.GDI.RecordType.META_SCALEVIEWPORTEXT:\n                case Helper.GDI.RecordType.META_FLOODFILL:\n                case Helper.GDI.RecordType.META_FRAMEREGION:\n                case Helper.GDI.RecordType.META_ANIMATEPALETTE:\n                case Helper.GDI.RecordType.META_EXTFLOODFILL:\n                case Helper.GDI.RecordType.META_SETPIXEL:\n                case Helper.GDI.RecordType.META_PATBLT:\n                case Helper.GDI.RecordType.META_PIE:\n                case Helper.GDI.RecordType.META_STRETCHBLT:\n                case Helper.GDI.RecordType.META_INVERTREGION:\n                case Helper.GDI.RecordType.META_PAINTREGION:\n                case Helper.GDI.RecordType.META_ARC:\n                case Helper.GDI.RecordType.META_CHORD:\n                case Helper.GDI.RecordType.META_BITBLT:\n                case Helper.GDI.RecordType.META_SETDIBTODEV:\n                case Helper.GDI.RecordType.META_DIBBITBLT:\n                default: {\n                    let recordName = \"UNKNOWN\";\n                    for (const name in Helper.GDI.RecordType) {\n                        const recordTypes: any = Helper.GDI.RecordType;\n                        if (recordTypes[name] === type) {\n                            recordName = name;\n                            break;\n                        }\n                    }\n                    Helper.log(\"[WMF] \" + recordName + \" record (0x\" + type.toString(16) + \") at offset 0x\"\n                        + curpos.toString(16) + \" with \" + (size * 2) + \" bytes\");\n                    break;\n                }\n            }\n\n            curpos += size * 2;\n        }\n\n        if (!all) {\n            throw new WMFJSError(\"Could not read all records\");\n        }\n    }\n\n    public play(gdi: GDIContext) {\n        const len = this._records.length;\n        for (let i = 0; i < len; i++) {\n            this._records[i](gdi);\n        }\n    }\n}\n"],"sourceRoot":""}